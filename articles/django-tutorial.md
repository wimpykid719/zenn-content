---
title: "ç´ äººãŒDjangoã§æŠ•ç¥¨ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦èº“ã„ãŸã¨ã“ã‚å‰ç·¨" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸŸ" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["django", "python"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
date: '2021.05.25'
---

## æœ€åˆã«

æœ¬æ ¼çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã„ã®ã§Pythonã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯Djangoï¼ˆèª­ã¿æ–¹ï¼šã‚¸ãƒ£ãƒ³ã‚´ã‚‰ã—ã„ã€‚ãƒ‡ã‚£ãƒ¼ã©ã“è¡Œã£ãŸã€‚ï¼‰ã«ã¤ã„ã¦ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã“ãªã—ãªãŒã‚‰å­¦ã‚“ã§è¡Œã“ã†ã¨æ€ã†ã€‚å®Ÿéš›ã«ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã¯è³ªå•ã«å¯¾ã—ã¦å›ç­”ã—ã¦æŠ•ç¥¨ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã«ãªã‚‹ã€‚

ã“ã®è¨˜äº‹ã¯å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®1ã€œ4ã¾ã§ã«æ°—ã«ãªã£ãŸäº‹èº“ã„ãŸäº‹ã‚’ã¾ã¨ã‚ã¦ã„ãã€‚å…¨éƒ¨ã§1ã€œ7ã¾ã§ã‚ã‚‹ãŒ4ã¾ã§ã«ã‚¢ãƒ—ãƒªã¯å®Œæˆã™ã‚‹ã€‚

5ã‹ã‚‰ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ç­‰ã‚’æ›¸ã„ã¦ã„ãã®ã§ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå¤šããªã‚‹ãŸã‚ã€å‰ç·¨ã¨ã—ã¦ä»Šå›ã®è¨˜äº‹ã‚’æŠ•ç¨¿ã™ã‚‹ã€‚å¾Œç·¨ã‚‚å¿…ãšæ›¸ã“ã†ã¨æ€ã†ã€‚

## ä»Šå›ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ä½œæˆã—ãŸã‚‚ã®

è³ªå•ä¸€è¦§ã®ãƒšãƒ¼ã‚¸ãŒã‚ã£ã¦ã€ãã“ã‹ã‚‰è³ªå•ã«å¯¾ã—ã¦æŠ•ç¥¨ã‚’è¡Œã†ã€‚ãã®å¾Œä»Šã¾ã§æŠ•ç¥¨ã•ã‚ŒãŸæ•°ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã€‚

![django-tutorial](https://user-images.githubusercontent.com/23703281/119465477-a8c5db00-bd7e-11eb-8245-df9008d26b42.gif)

## VSCodeã®Pythonç”¨ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã«ã‚ãŸã£ã¦æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã¯äº‹å‰ã«ç„¡ãã—ãŸã„ã®ã§ã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆãŒPythonç”¨ã«æä¾›ã—ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã®ã§ãã¡ã‚‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

è‡ªåˆ†ã¯anacondaç’°å¢ƒã§ã®ä½¿ç”¨ã‚’ã—ã¦ã„ã‚‹ã®ã§ä¸‹è¨˜ã®é€šçŸ¥ãŒå‡ºã¦ããŸã€‚

`terminal.integrated.inheritEnv` ã‚’ `false` ã«ã—ãŸæ–¹ãŒè‰¯ã„ã‚‰ã—ã„ã€‚

```
We noticed you're using a conda environment. If you are experiencing issues with this environment in the integrated terminal, we recommend that you let the Python extension change "terminal.integrated.inheritEnv" to false in your user settings.
```

VSCodeã® code > preference > settings ã« `terminal.integrated.inheritEnv` ã¨å…¥åŠ›ã—ã¦å‡ºã¦ããŸãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã€‚

[ã€Mac/Pythonã€‘VSCodeã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‹•ä½œãŒé€šå¸¸ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¨é•ã†æ™‚ | ã‚†ã†ãã®ã›ã‹ã„](https://yuki.world/vscode-terminal-python/)

ãã‚Œã ã‘ã ã¨ `Import "django.contrib" could not be resolved from source` ã¨ã„ã†è­¦å‘ŠãŒã§ãŸã¾ã¾ãªã®ã§ã€èµ¤æ ã®ç®‡æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Djangoã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸç’°å¢ƒã‚’é¸æŠã™ã‚‹ã¨è­¦å‘Šæ–‡ãŒæ¶ˆãˆã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/koqbmvs8nwqpy3bbt2tbjzlhutyx)

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å¥½ããªãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆã—ã¦ã€ãã“ã«é–‹ç™ºã—ã¦ã„ãã€‚Pythonã®ç’°å¢ƒæ§‹ç¯‰ã¯è‡ªåˆ†ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è¡Œã£ã¦ã„ã‚‹ã€‚

[https://techblog-pink.vercel.app/posts/cc111706c3167](https://techblog-pink.vercel.app/posts/cc111706c3167c)

anacondaã§ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¦ã€Djangoã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã€‚

```bash
pip install Django
```

é–‹ç™ºã‚’å§‹ã‚ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦ä¸‹è¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

```bash
django-admin startproject mysite
```

mysiteã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚

```
mysite/
    manage.py
    mysite/
        __init__.py
        settings.py
        urls.py
        asgi.py
        wsgi.py
```

ãƒ•ã‚©ãƒ«ãƒ€ã¯ã“ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ã€‚ `mysite/mysite` ã¨ãªã£ã¦ã„ã‚‹ã®ãŒä¸æ€è­°ã ã€‚å¤–å´ã® `mysite` ã¯Djangoã®ã‚·ã‚¹ãƒ†ãƒ çš„ã«ã¯ä½•ã§ã‚‚è‰¯ã„ã‚‰ã—ã„ã€‚

`urls.py` ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URLã‚’å®£è¨€ã™ã‚‹ã€‚ç›®æ¬¡ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ã€‚

å®Ÿè¡Œã™ã‚‹ã¨ [http://127.0.0.1:8000/](http://127.0.0.1:8000/) ã§ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

æœ€åˆã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç­‰ã®è¨­å®šã‚’ã—ã¦ã„ãªã„ã®ã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŒä»–ã«å•é¡ŒãŒãªã‘ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã€‚ `ctr + c` ã§ã‚µãƒ¼ãƒã‚’çµ‚äº†ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

```bash
python manage.py runserver
```

  

## GitHubã§ç®¡ç†ã™ã‚‹

ã“ã‚Œã‹ã‚‰é–‹ç™ºã—ã¦ã„ãã®ã§ã€Githubã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã’ã¦é€²æ—ã‚’ç®¡ç†ã—ãŸã„ã€‚ã—ã‹ã—ã€ã“ã®ã¾ã¾ã ã¨ `settings.py` ã«æ›¸ã‹ã‚ŒãŸ `SECRET_KEY` ã‚‚ä¸€ç·’ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã—ã¾ã†ã®ã§åˆ¥ãƒ•ã‚¡ã‚¤ãƒ« `local_settings.py` ã« `SECRET_KEY` ã‚’æ›¸ãã€‚ã¡ãªã¿ã«ç§ã¯æ°—ä»˜ã‹ãšã«ä¸€åº¦GitHubã«ã€ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ã—ã¦ã—ã¾ã£ãŸã€‚ãã®ãŸã‚æ–°ãŸã« `SECRET_KEY` ã‚’ä½œæˆã™ã‚‹æ‰‹é–“ãŒæ›ã‹ã‚‹ã€‚

`local_settings.py`

```python
SECRET_KEY = 'settings.pyã«ã‚ã£ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã¾ãŸã¯ã€æ–°ãŸã«ä½œæˆã—ãŸã‚‚ã®'
```

ã“ã®å¤‰æ•°ã‚’ `settings.py` ã§èª­ã¿è¾¼ã‚“ã§ã„ãã€‚ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã€‚

```python
try:
    # åŒã˜éšå±¤ã®local_settingsãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰SECRET_KEYã‚’keyã¨ã—ã¦èª­ã¿è¾¼ã‚€ã€‚
    # å‚è€ƒè¨˜äº‹ç­‰ã§ã¯ .local_settingsã¨ãªã£ã¦ã„ã‚‹ãŒã€local_settingsã¯ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§å¿…è¦ãªã„
    # å°†æ¥çš„ã«è¤‡é›‘ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã‚‹å¿…è¦ãŒå‡ºã¦ãƒ•ã‚©ãƒ«ãƒ€ã«ã™ã‚‹å ´åˆã¯ .ãŒå¿…è¦ã¨ãªã‚‹ã€‚
    # ãƒ€ãƒ¡ã ã£ãŸ .local_settingsãŒæ­£ã—ã‹ã£ãŸã€‚Djangoç’°å¢ƒã ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è¦‹ãªã•ã‚Œã‚‹ã®ã‹...
    from .local_settings import SECRET_KEY as key
except ImportError:
    pass

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã®éƒ¨åˆ†ã‚’èª­ã¿è¾¼ã‚“ã å¤‰æ•°ã«ç½®ãæ›ãˆã‚‹ã€‚
SECRET_KEY = key
```

å®Ÿéš›ã« `test.py` ã¨ `test2.py` ã‚’åŒã˜éšå±¤ã«ä½œæˆã—ã¦ã©ã®ã‚ˆã†ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‹èª¿ã¹ã¦ã¿ãŸã€‚

`test.py`

```python
hello = "hello"
```

`test2.py`

```python
# .testã¨ã™ã‚‹ã¨ImportError: attempted relative import with no known parent package
# ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
# asã‚’ä»˜ã‘ãªã„å ´åˆã¯ helloã§èª­ã¿è¾¼ã¾ã‚Œã‚‹ã€‚
from test import hello as A

print(A)
```

`settings.py` ã¨åŒã˜ç’°å¢ƒã«å‡ºæ¥ã¦ã„ã‚‹ã¨æ€ã£ãŸãŒã€å…¨ç„¶é•ã£ãŸã€‚ `local_settings.py` ã¯ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ãŒã€ `test.py` ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦èªè­˜ã•ã‚Œãªã„ã®ã§ `.` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚ãã‚‚ãã‚‚ `python test2.py` ã¨ç›´æ¥å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã§ `settings.py` ã¨ã¯é•ã†å®Ÿè¡ŒçŠ¶æ³ã«ãªã‚‹ã€‚

è©³ã—ãã¯[ã“ã“ã§å›ç­”ã‚’é ‚ã„ã¦ã„ã‚‹ã€‚](https://ja.stackoverflow.com/questions/75892/python-django-%e3%81%aeimport%e3%81%ae%e9%9a%9b%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b-%e3%83%89%e3%83%83%e3%83%88-%e3%81%8c%e3%81%a9%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%95%e3%82%8c%e3%82%8b%e3%81%ae%e3%81%8b%e5%88%86%e3%81%8b%e3%82%89%e3%81%aa%e3%81%84/75895?noredirect=1#comment85968_75895)

## SECRET_KEYã®ä½œæˆ

è‡ªåˆ†ã¯çŸ¥ã‚‰ãšã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’GitHubã«ã‚ã’ã¦ã—ã¾ã£ãŸã®ã§æ–°ãŸã«ä½œã‚Šç›´ã™å¿…è¦ãŒã‚ã‚‹ã®ã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã“ã‚Œã‚’ç›´æ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã™ã‚‹ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ãã‚Œã‚’ `local_settings.py` ã«è²¼ã‚Šä»˜ã‘ã‚‹ã€‚

`get_random_secret_key.py`

```python
from django.core.management.utils import get_random_secret_key

secret_key = get_random_secret_key()
text = 'SECRET_KEY = \'{0}\''.format(secret_key)
print(text)
```

ã“ã‚Œã§ã‚ˆã†ã‚„ããƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«å°‚å¿µã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãé€²ã‚ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚¢ãƒ—ãƒª

Djangoã§ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã‚¢ãƒ—ãƒªãŒå«ã¾ã‚Œã‚‹ã€‚ãªã®ã§ç‰¹å®šã®Djangoã§ä½œæˆã•ã‚ŒãŸWebã‚µã‚¤ãƒˆå…¨ä½“ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å‘¼ã³ã€ãã®ä¸­ã«å«ã¾ã‚Œã‚‹å°è¦æ¨¡ãªæŠ•ç¥¨ã‚¢ãƒ—ãƒªã€ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¢ãƒ—ãƒªã¨å‘¼ã¶ã€‚

## ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ã€‚

`manage.py` ã¨åŒã˜éšå±¤ã«ç§»å‹•ã—ã¦

```bash
python manage.py startapp polls
```

ã‚’å®Ÿè¡Œã™ã‚‹ã¨ `polls` ã¨ã„ã†ãƒ•ã‚©ãƒ«ãƒ€ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚

```
polls/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
```

ã“ã‚Œã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«pollsã¨ã„ã†ã‚¢ãƒ—ãƒªãŒä½œæˆã•ã‚ŒãŸäº‹ã«ãªã‚‹ã€‚

## Viewã‚’ä½œæˆã™ã‚‹ã€‚

URLã‹ã‚‰ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚ã£ã¦ã€ãã®éš›ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ãŒViewã«ãªã‚‹ã“ã“ã§HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã—ãŸã‚Šã¨å‡¦ç†ã‚’æ±ºã‚ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

`views.py` ã«è¨˜è¿°ã™ã‚‹ã€‚

```python
def detail(request, question_id):
    return HttpResponse("You're looking at question %s." % question_id)

def results(request, question_id):
    response = "You're looking at the results of question %s."
    return HttpResponse(response % question_id)

def vote(request, question_id):
    return HttpResponse("You're voting on question %s." % question_id)
```

viewãƒ¡ã‚½ãƒƒãƒ‰ã®ç¬¬ä¸€å¼•æ•°ã«ã¯å¿…ãšHttpRequestã‚¯ãƒ©ã‚¹ã‚’å—ã‘å–ã‚‹ã€‚

å¼•æ•° `request` ã«ã¯ä»Šãƒ¦ãƒ¼ã‚¶ãŒã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹URLã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®æƒ…å ±ãŒå…¥ã£ã¦ãã‚‹ã€‚ãã—ã¦æˆ»ã‚Šå€¤ã¨ã—ã¦ã¯ HttpResponseã‚¯ãƒ©ã‚¹ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ã€‚

å®Ÿéš›ã«HttpResponseã¨HttpRequestã®ä¸­èº«ãŒã©ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã‚‹äººã¯ä¸‹è¨˜ã®ãƒšãƒ¼ã‚¸ã§ç¢ºèªã§ãã¾ã™ã€‚

ã–ã£ãã‚Šã§ã™ãŒã€ `views.py` ãŒã‚ã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã‚¯ãƒ©ã‚¹ã®ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚

```python

def sample(request):
    print(request)
    response = HttpResponse('')
    print(response)
    return response

# å®Ÿè¡Œçµæœ
# <WSGIRequest: GET '/hello/'>
# <HttpResponse status_code=200, "text/html; charset=utf-8">
```

[Djangoã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€è©³ã—ãè§£èª¬ã€‘](https://codor.co.jp/django/request-and-response)

`views.py` ã ã‘ã§ã¯URLã¨ç´ã¥ã„ã¦ã„ãªã„ã®ã§ URLconfã‚’ä½œæˆã™ã‚‹ã€‚

## URLconf `urls.py` ã‚’ä½œæˆã™ã‚‹

URLconfã‚’ä½œæˆã™ã‚‹ã«ã¯ `urls.py` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `views.py` ã¨åŒã˜éšå±¤ã«ä½œæˆã™ã‚‹ã€‚mysiteãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã¯ `urls.py`  ãŒã™ã§ã«ã‚ã‚‹ã®ã§ pollsãƒ•ã‚©ãƒ«ãƒ€å†…ã«ä½œæˆã™ã‚‹ã€‚ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚

### include()ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã®URLã‚’çµã³ä»˜ã‘ã‚‹ã€‚

`polls/urls.py`

```python
from django.urls import path

from . import views

urlpatterns = [
    path('', views.index, name='index'),
    path('<int:question_id>/', views.detail, name='detail'),
    path('<int:question_id>/results/', views.results, name='results'),
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
```

 `<int:question_id>` ãŒ `views.py` é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ã€‚ã“ã® `<>` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€URLã®ä¸€éƒ¨ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œæ¸¡ã•ã‚Œã‚‹ã€‚æ–‡å­—åˆ— `:quesiton_id>` ã¯ä¸€è‡´ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©ã—ã€ `<int:` ã®éƒ¨åˆ†ã¯URLãƒ‘ã‚¹ã«å½“ã¦ã¯ã¾ã‚‹å€¤ã®å‹ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚ãªã®ã§ `<str:, <slug:` ãªã©ã‚‚ã‚ã‚‹ã€‚ 

ãã—ã¦ã€ã“ã‚Œã‚’mysiteãƒ•ã‚©ãƒ«ãƒ€å†…ã® `urls.py` ã«çµã³ã¤ã‘ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ä¸€å¿œã“ã£ã¡ãŒæœ€åˆã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã§ã“ã“ã«å¾Œã‹ã‚‰è¿½åŠ ã—ãŸã‚¢ãƒ—ãƒªã®URLã‚’ `include()` ã‚’ä½¿ã£ã¦è¿½åŠ ã—ã¦ã„ãã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚‹ã€‚

`mysite/urls.py` 

```python
from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path('polls/', include('polls.urls')),
    path('admin/', admin.site.urls),
]
```

ã“ã‚Œã§pollsã‚¢ãƒ—ãƒªã®URLã‚’çµã³ä»˜ã‘ã‚‹ã“ã¨ãŒã§ããŸã€‚ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ [http://localhost:8000/polls/](http://localhost:8000/polls/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ViewãŒè¿”ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

### path()ã®å¼•æ•°

4ã¤ã®å¼•æ•°ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚ãã®ã†ã¡ `route` ã¨ `view` ã®2ã¤ã¯å¿…é ˆã§æ®‹ã‚Š `kwargs` ã¨ `name` ã¯çœç•¥å‡ºæ¥ã‚‹ã€‚

- routeï¼šURLãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚€æ–‡å­—åˆ—ãŒå…¥ã‚‹ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹éš›ã« `urlpatterns` ã‚’é †ç•ªã«ã¿ã¦æœ€åˆã«ãƒãƒƒãƒã—ãŸã‚‚ã®ã‚’å–ã‚Šå‡ºã™ã€‚ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯GETã€POSTã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å½±éŸ¿ã¯å—ã‘ãªã„ã‚ãã¾ã§URLãƒ‘ã‚¹ã ã‘ã‚’è¦‹ã‚‹ã€‚
- viewï¼šURLãŒãƒãƒƒãƒã—ãŸã‚‰ã€ãã“ã«ä»˜éšã™ã‚‹Viewé–¢æ•°ã‚’è¿”ã™ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã€‚
- kwargsï¼šä»»æ„ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã‚’è¾æ›¸ã¨ã—ã¦Viewé–¢æ•°ã«æ¸¡ã›ã‚‹ã€‚
- nameï¼šURLã«åå‰ã‚’ä»˜ã‘ã‚‹äº‹ã§ `reverse()` ã‚’ä½¿ã£ã¦å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã€htmlã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§formã«æŒ‡å®šã™ã‚‹URLã‚’å¤‰æ›´ã™ã‚‹éš›ã«å‹•çš„ã«URLãŒå¤‰æ›´ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

`polls/urls.py` ãŒã“ã‚“ãªæ„Ÿã˜ã ã¨ã—ã¦

```python
from django.urls import path

from . import views
import re

urlpatterns = [
    path('', views.index, name='index'),
    path('<int:number>', views.subView, name='suburl'),
]
```

è©¦ã—ã«ä¸‹è¨˜ã® `views.py` ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚

```python
from django.http import HttpResponse
from django.urls import reverse

def index(request):
    urlName = reverse('index')
    print(urlName)
    return HttpResponse("Hello, world. You're at the polls index.{0}".format(urlName))

# å®Ÿè¡Œçµæœ
# /polls/
```

ã“ã†ã™ã‚‹ã¨ä¾‹ãˆã° `pollllllls/urls.py` ã¨URLã‚’å¤‰æ›´ã—ã¦ã‚‚ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªã„ã®ã§ã€å¤‰æ›´ã«å¼·ã„ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

â€»pathã®nameã«ã¤ã„ã¦

[pythonã€djangoã®urls.pyã§è¨­å®šã™ã‚‹nameã£ã¦ãªã‚“ã‚„ã­ã‚“ï¼Ÿï¼Ÿ - Qiita](https://qiita.com/sr2460/items/11a1129975913ed584d3)

## Djangoã®URL

ãƒ¦ãƒ¼ã‚¶ãŒDjangoã§ä½œã‚‰ã‚ŒãŸã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸéš›ã«ã©ã®ã‚ˆã†ãªå‡¦ç†ãŒèµ°ã‚‹ã®ã‹ã€‚

1. ROOT_URLCONFã«è¨­å®šã•ã‚Œã¦ã„ã‚‹URLã‚’ç¢ºèªã™ã‚‹ã€‚ï¼ˆHttpRequestã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«urlconfã¨ã„ã†å±æ€§ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã®å€¤ã‚’ROOT_URLCONFã¨ã™ã‚‹ã€‚ï¼‰
2. urlpatternsã¨ã„ã†åå‰ã®å¤‰æ•°ã‚’æ¢ã™ã€‚ã“ã®å¤‰æ•°å€¤ã¯ `django.urls.path()` ã¾ãŸã¯ `django.urls.re_path()` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®sequenceã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
3. urlpatternsã‹ã‚‰é †ç•ªã«è¦æ±‚ã•ã‚ŒãŸURLãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¢ã™ã€‚
4. ãƒãƒƒãƒã—ãŸã‚‰Viewã‚’è¿”ã™ã€‚
5. ãƒãƒƒãƒã—ãªã‹ã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ“ãƒ¥ãƒ¼ã‚’è¿”ã™ã€‚

URLconfã®ã‚µãƒ³ãƒ—ãƒ«

pathã®å·¦å´ãŒãƒãƒƒãƒã™ã‚‹URLï¼ˆrouteï¼‰, å³å´ãŒãƒãƒƒãƒã—ãŸã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ï¼ˆviewï¼‰

```python
from django.urls import path

from . import views

urlpatterns = [
    # /articles/2003/ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆ
    # Views.special_case_2003(request)ã‚’å‘¼ã³å‡ºã™ã€‚æœ€å¾Œã®/ã‚‚ã—ã£ã‹ã‚Šãªã„ã¨ãƒãƒƒãƒã—ãªã„ã€‚
    # å¼•æ•°ã¨ã—ã¦requestãŒé–¢æ•°ã«æ¸¡ã‚‹ã€‚
    path('articles/2003/', views.special_case_2003),
    path('articles/<int:year>/', views.year_archive),
    path('articles/<int:year>/<int:month>/', views.month_archive),
    path('articles/<int:year>/<int:month>/<slug:slug>/', views.article_detail),
]
```

`/articles/2005/03/` ã¨ã„ã†ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚ã£ãŸå ´åˆä¸Šè¨˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸­ã‹ã‚‰`views.month_archive(request, year=2005, month=3)` ã¨ã„ã† `views.py` ï¼ˆä¸Šè¨˜ã§è¨˜ã—ãŸviews.pyã¨ã¯åˆ¥ã§ä¾‹ã¨ã—ã¦ã‚ã’ã¦ã‚‹urls.pyã«å¯¾å¿œã™ã‚‹views.pyãŒã‚ã£ãŸã‚‰ã¨ã„ã†è©±ã§è¦‹ã¦ã‚‚ã‚‰ã„ãŸã„ã€‚ï¼‰ã«æ›¸ã‹ã‚ŒãŸviewãƒ¡ã‚½ãƒƒãƒ‰ã«å¼•æ•°ã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã™äº‹ã«ãªã‚‹ã€‚å¼•æ•° `request` ã«ã¯HttpRequestã‚¯ãƒ©ã‚¹ãŒå…¥ã‚Š ä»Šãƒ¦ãƒ¼ã‚¶ãŒã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹URLã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®æƒ…å ±ãŒå…¥ã£ã¦ã‚‹ã€‚

`/articles/2003/03/building-a-django-site/` ãªã‚‰æœ€å¾Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã—ã¦ã€ã“ã®ã‚ˆã†ã« `views.article_detail(request, year=2003, month=3, slug="building-a-django-site")` é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚

## ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®è¨­å®š

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯UTCã¨ä¸–ç•Œæ¨™æº–æ™‚é–“ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§æ—¥æœ¬æ™‚é–“ã«å¤‰æ›´ã—ã¦ãŠããŸã„ã¨æ€ã†ã€‚ `settings.py` ã® `TIME_ZONE = 'UTC'` ã‚’ `TIME_ZONE = 'Asia/Tokyo'` ã«å¤‰æ›´ã™ã‚‹ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨èªã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ç½®ãã€‚

![](https://storage.googleapis.com/zenn-user-upload/ury5lr13z2uiguvdb3hajfo31gll)

- ã‚«ãƒ©ãƒ ï¼šç¸¦åˆ—ã®äº‹ã‚’æŒ‡ã—ã€åˆ¥åã§ã¯åˆ—ã¨å‘¼ã°ã‚Œã‚‹ã€‚
- ã‚«ãƒ©ãƒ åï¼šåˆ—å…¨ä½“ã«ä»˜ã‘ã‚‰ã‚ŒãŸåå‰
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹å ´æ‰€ã€‚
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åï¼šãã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã‚«ãƒ©ãƒ åã‚’æŒ‡ã™ã€‚
- é …ç›®åï¼šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’æŒ‡ã™ã€‚
- ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šExcelã§ã„ã†ã‚·ãƒ¼ãƒˆã®ã‚ˆã†ãªã‚‚ã®ã€‚
- ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼šãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã‚’æŒ‡ã™è¨€è‘‰ã«ãªã‚‹ã€‚ã‚‚ã†ä¸€ã¤ã¯æ¨ªåˆ—ã®äº‹ã‚’æŒ‡ã—ã€è¡Œã¨å‘¼ã°ã‚Œã‚‹ã€‚ãã—ã¦è¡Œã‚’ãƒ­ã‚¦ã¨å‘¼ã¶ã“ã¨ã‚‚ã‚ã‚‹ã€‚

ã“ã‚Œã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¨­å®šã—ã¦ã„ãã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®æ®µéšãªã®ã§ã¾ãšã¯è¤‡é›‘ãªè¨­å®šã®å¿…è¦ãŒãªã„SQLiteã‚’ä½¿ç”¨ã—ã¦ã„ãã€‚

```bash
python manage.py migrate
```

å®Ÿè¡Œã™ã‚‹ã¨ `settings.py` ã«æ›¸ã‹ã‚ŒãŸ `INSTALLED_APPS` ã®è¨­å®šã‚’å‚ç…§ã—ã¦ `mysite/settings.py` ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã«å¾“ã£ã¦å¿…è¦ãªå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

## migrateï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ãƒˆï¼‰ã™ã‚‹ã¨ã¯

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰ä½œã‚Šç›´ã™ã¨ã€DBã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ãŒå…¨ã¦å‰Šé™¤ã•ã‚Œã¦ã—ã¾ã†ã€‚ã“ã†ã„ã£ãŸäº‹æ…‹ã‚’å›é¿ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†æ–¹æ³•ãŒç”Ÿã¾ã‚ŒãŸã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ã€DBã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãŸã¾ã¾ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã‚„ã‚«ãƒ©ãƒ ã®å¤‰æ›´ãªã©ã‚’è¡Œã†ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚

## ãƒ¢ãƒ‡ãƒ«ã®ä½œæˆ `models.py`

`models.py` ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ãŸã‚Šã€å–ã‚Šå‡ºã—ãŸã‚Šã™ã‚‹ã¨ãã®è¨­å®šã‚’è¨˜éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å–æ‰±èª¬æ˜æ›¸ã¨æ›¸ã‹ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚

### `models.py` ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹æµã‚Œ

1. models.pyãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å‹ï¼‰ã‚’ä½œæˆã™ã‚‹ã€‚
2. migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚
3. migrateï¼ˆæœ€çµ‚çš„ã«ã¯ãŠãã‚‰ãSQLæ–‡ã«å¤‰æ›ã•ã‚Œã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å‘½ä»¤ã‚’å‡ºã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚ï¼‰ã™ã‚‹ã€‚ã“ã“ã§ä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã€‚

ã¤ã¾ã‚Šãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ãã‚Œã«ä»˜éšã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‚

ç°¡å˜ãªä¾‹ã‚’ç¤ºã™ã€‚ï¼ˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã¯é–¢ä¿‚ãªã„ãƒ¢ãƒ‡ãƒ«ï¼‰

```python
# modelsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã‚Œã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã®ã«å¿…è¦ãªæ©Ÿèƒ½ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚
from django.db import models

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆæ©Ÿèƒ½ã‚’ç¶™æ‰¿ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’æ›¸ãè¾¼ã‚“ã§ã„ãã€‚
class BookModel(models.Model):
    # booknameã¨ã„ã†æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½œæˆã™ã‚‹å‘½ä»¤ã‚’ã ã™ã€‚
    # bookname = models.CharField(max_length = 50)ã¨ã™ã‚‹ã¨50æ–‡å­—ã¾ã§ã¨åˆ¶é™ã‚’ã‹ã‘ã‚Œã‚‹ã€‚
    # CharFieldã«ã¯å¿…é ˆã®å¼•æ•°ãŒã‚ã‚Šmax_lengthã‚’è¨­å®šã—ãªã„ã¨ã„ã‘ãªã„ã€‚
    bookname = models.CharField(max_length = 50)
    # CharFieldã¨ã»ã¼åŒã˜ã§æ–‡å­—åˆ—ã‚’æ‰±ã†ãŒTextFieldã®æ–¹ãŒãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å‡ºã—ç­‰ã«ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ã‚‰ã—ã„ã€‚
    summary = models.TextField()
    # æ•´æ•°å€¤ã‚’å…¥ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½œæˆã™ã‚‹ã€‚
    rating = models.IntegerField()
```

ä»Šåº¦ã¯å°‘ã—è¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ã‚’è¦‹ã¦ã„ãã€‚

Questionã¨Choiceã¨ã„ã†2ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

Choiceã«QuestionãŒ `ForeignKey` ã‚’ä½¿ã£ã¦ç´ãšã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ `on_delete=models.CASCADE` ã¯ç´ã¥ã‘ã‚‰ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ãŒå‰Šé™¤ã•ã‚Œã‚‹éš›ã«ã©ã®ã‚ˆã†ãªå‹•ä½œã‚’ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã€‚å‰Šé™¤ã•ã‚ŒãŸå¾Œãã®ãƒ¢ãƒ‡ãƒ«ã ã£ãŸéƒ¨åˆ†ã‚’Nullã§åŸ‹ã‚ãŸã‚Šã€ãã‚‚ãã‚‚å‰Šé™¤ã§ããªã„ã‚ˆã†ã«ã—ãŸã‚Šã¨å‡ºæ¥ã‚‹ã€‚ `CASCADE` ã¯ç´ã¥ã‘ã‚‰ã‚ŒãŸå´ã®ãƒ¢ãƒ‡ãƒ«ã§é–¢é€£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å‰Šé™¤ã™ã‚‹ã¨ã„ã†å‹•ãã«ãªã‚‹ã€‚ãªã®ã§ QuestionãŒå‰Šé™¤ã•ã‚ŒãŸã‚‰ã€Questionã¨é–¢é€£ã®ã‚ã‚‹Choiceå´ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å‰Šé™¤ã™ã‚‹ã‚ˆã†ãªå‹•ä½œã‚’å–ã‚‹ã€‚

è©³ã—ãã¯ã“ã“ã®è¨˜äº‹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

[Django2.0ã‹ã‚‰å¿…é ˆã«ãªã£ãŸon_deleteã®ä½¿ã„æ–¹ - DjangoBrothers](https://djangobrothers.com/blogs/on_delete/)

```python
from django.db import models

class Question(models.Model):
    # Question textã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ãã“ã«å…¥ã‚‹æ–‡å­—åˆ—ã¯200æ–‡å­—ã¾ã§ã¨åˆ¶é™ã—ã¦ã„ã‚‹ã€‚
    question_text = models.CharField(max_length=200)
    # åŸºæœ¬çš„ã«ã¯å¤‰æ•°åãŒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãŒã€å¼•æ•°ã§æ–‡å­—åˆ—ã‚’æ¸¡ã™äº‹ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åè¨­å®šã™ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã€‚
    pub_date = models.DateTimeField('date published')

class Choice(models.Model):
    # Question â† â†’ Choiseã¨åŒæ–¹å‘ã®ã‚„ã‚Šã¨ã‚ŠãŒå¯èƒ½ã¨ãªã‚‹ã€‚
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    # Votesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ•´æ•°å€¤ã‚’å—ã‘ä»˜ã‘ã‚‹ã€‚æœ€åˆã¯0ãŒå…¥ã‚‹ã€‚
    votes = models.IntegerField(default=0)
```

ãƒ¢ãƒ‡ãƒ«é–“ã®åŒæ–¹å‘ã‚„ã‚Šã¨ã‚Šã«ã¤ã„ã¦

[ã€Djangoã€‘1å¯¾å¤šã®é–¢ä¿‚ï¼ˆ related_name, _set.all() ï¼‰ã«ã¤ã„ã¦ - Qiita](https://qiita.com/taki_21/items/d461072e6ea65630171a)

ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ãŸã®ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ãƒˆï¼ˆãƒ¢ãƒ‡ãƒ«ã‚’å…ƒã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œæˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã€‚ï¼‰ã—ã¦ã„ã

migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å‰ã«ã€æ–°ãŸã«ä½œæˆã—ãŸã‚¢ãƒ—ãƒªpollsã‚’ä¼ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ `settings.py` ã® `INSTALLED_APPS` ã®é…åˆ—ã« `'polls.apps.PollsConfig',` ã‚’è¿½åŠ ã™ã‚‹ã€‚

æ¬¡ã«migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

æ–°ãŸã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ã¯ãªãã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã™ã‚‹ã€‚

```bash
python manage.py makemigrations polls
```

å®Ÿè¡Œã™ã‚‹ã¨ `models.py` ã‚’å…ƒã«migrationãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚

```bash
python manage.py migrate
```

å®Ÿè¡Œã™ã‚‹ã¨migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã€‚

è©¦ã—ã«ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰Django shellã‚’é€šã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¤‰æ›´ã—ãŸã‚Šã—ã¦ã¿ã‚‹ã€‚

ã‚·ã‚§ãƒ«ã«å…¥ã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

```bash
python manage.py shell
```

ã™ã‚‹ã¨Pythonã‚³ãƒ¼ãƒ‰ `>>>` ã‚’æ›¸ã‘ã‚‹çŠ¶æ…‹ã«ãªã‚‹ã®ã§ã“ã“ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€‚

```python
# ä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€
from polls.models import Choice, Question

# æ ¼ç´ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ã€‚ã¾ã è¿½åŠ ã—ã¦ã„ãªã„ã®ã§ã€ç©ºã«ãªã£ã¦ã„ã‚‹ã€‚
Question.objects.all()

from django.utils import timezone
# ãƒ¢ãƒ‡ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã€‚
q = Question(question_text="What's new?", pub_date=timezone.now())
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ã€‚
q.save()

q.id
q.question_text
q.pub_date

# ãƒ‡ãƒ¼ã‚¿ã®ä¸Šæ›¸ã
q.question_text = "What's up?"
q.save()

# ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã€‚
Question.objects.all()
# å®Ÿè¡Œçµæœï¼š<QuerySet [<Question: Question object (1)>]>
```

![](https://storage.googleapis.com/zenn-user-upload/d768fm3g728u653rzmzij3l9yhf9)

ã“ã®ã¾ã¾ã§ã¯adminãƒšãƒ¼ã‚¸ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåãŒ `Question object (1)` ã¨è¡¨ç¤ºã•ã‚Œåˆ†ã‹ã‚Šã«ãã„ã®ã§ ç‰¹æ®Šãƒ¡ã‚½ãƒƒãƒ‰ `__str__()` ã‚’ãƒ¢ãƒ‡ãƒ«ã«è¿½åŠ ã™ã‚‹ã€‚

ã‚ã¨è¿½åŠ ã§ `was_published_recently(self)` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ãã¾ã—ãŸã€‚

ãƒ‡ãƒ¼ã‚¿ãŒæœ€è¿‘è¿½åŠ ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ `True or False` ã§è¿”ã—ã¾ã™ã€‚

```python
class Question(models.Model):
  # ã‚¯ãƒ©ã‚¹å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¡¨ç¾ã—ã¦ã„ã‚‹ã€‚
  # Charãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ–‡å­—ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  question_text = models.CharField(max_length=200)

  # æ—¥æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  pub_date = models.DateTimeField('date published')

  def __str__(self):
    # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦ã€printã—ãŸéš›ã«ã“ã“ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚
    # ã‚·ã‚§ãƒ«ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è³ªå•åãŒä½¿ã‚ã‚Œã‚‹ã ã‘ã§ãªã
    # adminã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ç¾ã™ã‚‹éš›ã«ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹ã®ã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
    return self.question_text

  def was_published_recently(self):
    now = timezone.now()
    # now - datetime.timedelta(days=1)ã¯ä»Šã®æ™‚é–“ã‹ã‚‰ä¸€æ—¥å¼•ã„ãŸæ—¥ä»˜ã‚’å‡ºã™ã€‚
    # 2021-05-19 23:29:56.216634ã“ã‚“ãªæ„Ÿã˜ã®å€¤ã«ãªã‚‹ã€‚
    # pub_dateãŒç¾åœ¨æ™‚åˆ»ã‚ˆã‚Šéå»ã§ç¾åœ¨æ™‚åˆ»ã‹ã‚‰ä¸€æ—¥ä»¥å†…ã®å ´åˆã¯Trueã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰
    return now - datetime.timedelta(days=1) <= self.pub_date <= now
  
class Choice(models.Model):

  # ã“ã‚Œã¯ChoiceãŒQuestionã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹äº‹ã‚’ä¼ãˆã¦ã„ã‚‹ã€‚
  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤šå¯¾ä¸€ã€å¤šå¯¾å¤šã€ä¸€å¯¾ä¸€ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã«å¯¾å¿œã™ã‚‹ã€‚
  # Question â† â†’ Choiseã¨åŒæ–¹å‘ã®ã‚„ã‚Šã¨ã‚ŠãŒå¯èƒ½ã¨ãªã‚‹ã€‚
  question = models.ForeignKey(Question, on_delete=models.CASCADE)
  choice_text = models.CharField(max_length=200)
  votes = models.IntegerField(default=0)

  def __str__(self):
    return self.choice_text
```

ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€

![](https://storage.googleapis.com/zenn-user-upload/ejo29u3azzc9mjkets12mobuxn42)

ä½•ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šæ˜“ããªã£ãŸã€‚

Djangoã®shellå†…ã§ã‚‚ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«ãŒåˆ†ã‹ã‚Šæ˜“ããªã£ãŸã€‚

```python
from polls.models import Choice, Question
Question.objects.all()
# å®Ÿè¡Œçµæœï¼š<QuerySet [<Question: What's up?>]>

# ç¶šã‘ã¦è‰²ã€…ãªé–¢æ•°ã‚’è©¦ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰
# ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã¿ã‚‹ã€‚
# filterã‚’ã‹ã‘ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€‚
# idã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ãŸéš›ã«1ã‹ã‚‰é †ç•ªã«è‡ªå‹•ã§å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ã€‚
Question.objects.filter(id=1)
# å®Ÿè¡Œçµæœï¼š<QuerySet [<Question: What's up?>]>

# Questionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®question_textãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§"What"ã‹ã‚‰
# å§‹ã¾ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€‚
Question.objects.filter(question_text__startswith="What")
# å®Ÿè¡Œçµæœï¼š<QuerySet [<Question: What's up?>]>

from django.utils import timezone

# ä»Šå¹´ä½œæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€‚
current_year = timezone.now().year
Question.objects.get(pub_date__year=current_year)

# id 2ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€‚
# filterã§æŒ‡å®šã—ãªãã¦ã‚‚getã§ã‚‚å–å¾—ã§ãã‚‹ã€‚
Question.objects.get(id=2)
# å®Ÿè¡Œçµæœã¯ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

# ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚­ãƒ¼ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã„ã¾ã„ã¡idã¨ã®é•ã„ãŒåˆ†ã‹ã‚‰ãªã„ã€‚
# å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯idã®å ´åˆã¨åŒã˜ã«ãªã‚‹ã€‚
q = Question.objects.get(pk=1)
q.was_published_recently()
# å®Ÿè¡Œçµæœï¼šTrue

# Choiseã¯Questionã¨é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã‚‹ã®ã§Questionã‹ã‚‰ã‚‚
# ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹äº‹ãŒã§ãã‚‹ã€‚
# Choiceå´ã«ã¯ã¾ã ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ãªã„ã®ã§çµæœã¯ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã€‚
# Choicecã¯è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã®é¸æŠè‚¢ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æŒã¤ã€‚
# qã«ã¯ä»ŠWhat's upã¨ã„ã†è³ªå•ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€ãã‚Œã«å¯¾ã—ã¦ã®
# é¸æŠè‚¢ã‚’ä½œæˆã—ãŸã€‚
q.choice_set.all()
q.choice_set.create(choice_text="Not much", votes=0)
q.choice_set.create(choice_text="The sky", votes=0)
c = q.choice_set.create(choice_text='Just hacking again', votes=0)

# é¸æŠè‚¢ãŒé–¢é€£ã¥ã‘ã‚‰ã‚Œã¦ã„ã‚‹è³ªå•ã‚’è¿”ã™ã€‚
c.question
# å®Ÿè¡Œçµæœï¼š<Question: What's up?>
q.choice_set.all()

# é¸æŠè‚¢ãŒä½•å€‹ã‚ã‚‹ã‹æ•°ãˆã‚‹ã€‚
q.choice_set.count()

Choice.objects.filter(question__pub_date__year=current_year)
# å®Ÿè¡Œçµæœï¼š<QuerySet [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]>

# just hackingã®é¸æŠè‚¢ã ã‘å‰Šé™¤ã™ã‚‹ã€‚
c = q.choice_set.filter(choice_text__startswith="Just hacking")
c.delete()
```

## pkã¨idã®é•ã„

pkã¯ `primary key` ã®ç•¥ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯ `ä¸»ã‚­ãƒ¼` ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚ä¸»ã‚­ãƒ¼ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã§ä¸€æ„ã®å€¤ã‚’å–ã‚‹ã€‚

ã©ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸»ã‚­ãƒ¼ã«ã™ã‚‹ã‹ã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’å®šç¾©ã™ã‚‹æ™‚ã« `primary_key=True` ã‚’ä»˜ã‘ã‚Œã°è¨­å®šã§ãã‚‹ã€‚

codeã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å…¥ã‚‹å€¤ã‚’ä¸»ã‚­ãƒ¼ã¨ã™ã‚‹ã€‚

```python
code = models.CharField(max_length=10, primary_key=True)
```

djangoã®å ´åˆã¯Modelï¼ˆ=ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã«ã¯å¿…ãš1ã¤ã®ä¸»ã‚­ãƒ¼ç”¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…è¦ã«ãªã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãŒå®šç¾©ã—ãªã„å ´åˆã¯idã¨ã„ã†åå‰ã®AutoFiekdï¼ˆintå‹ã®é€£ç•ª1~nï¼‰ãŒä½œæˆã•ã‚Œã‚‹ã€‚

ãã®ãŸã‚ã€pkã‚­ãƒ¼ã‚’å®šç¾©ã—ãªã„å ´åˆã¯pkã¯idã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã«ãªã‚‹ã€‚

pkã‚­ãƒ¼ã‚’ä¸Šè¨˜ã® `code` ã®ã‚ˆã†ã«å®šç¾©ã—ãŸå ´åˆã¯idã¯ä½œæˆã•ã‚Œãªã„ã€‚

ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹äº‹ãŒã§ããŸã®ã§ã€æ¬¡ã«å…ˆã»ã©ç™»å ´ã—ãŸadminãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„ã¨æ€ã†ã€‚

## adminãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚

ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªã®ã§ãƒ¦ãƒ¼ã‚¶ã‚’ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ä½œæˆã™ã‚‹ã€‚

```bash
python manage.py createsuperuser
# å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã®å…¥åŠ›ç”»é¢ãŒç™»å ´ã™ã‚‹ã€‚
Usernameï¼šåå‰ã‚’å…¥åŠ›
Email addressï¼š@ã¨.comãŒã‚ã‚Œã°æ¶ç©ºã§è‰¯ã„
Passwordï¼š
Passwordï¼ˆagainï¼‰ï¼š
```

ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã—ãŸã‚‰é–‹ç™ºã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦[http://127.0.0.1:8000/admin/](http://127.0.0.1:8000/admin/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨ãªã‚‹ã®ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚

ã™ã‚‹ã¨ãã“ã‹ã‚‰ä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«ã‚’é–²è¦§ã—ãŸã‚Šãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ãŸã‚Šã§ãã‚‹ã€‚

## Views.pyã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å€¤ã‚’å–å¾—ã™ã‚‹

å…ˆã»ã©Django shellã§ä½¿ç”¨ã—ãŸPythonã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€ `views.py` ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãã€‚

```python
# æœ€å¾Œã¯HttpResponseã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ã®ã§importã™ã‚‹ã€‚
from django.http import HttpResponse

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãŠãã€‚
from .models import Question

def index(request):
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€æ–°5ä»¶ã‚’å–å¾—ã™ã‚‹ã€‚
    # ã“ã‚“ãªæ„Ÿã˜ã®ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‚<QuerySet [<Question: test3>, <Question: hello>, <Question: what's up?>]>
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    # "test3, hello, what's up?"åŒºåˆ‡ã£ãŸæ–‡å­—åˆ—ã«ã—ã¦HttpResponseã«æ¸¡ã™ã€‚
    output = ', '.join([q.question_text for q in latest_question_list])
    return HttpResponse(output)

# Leave the rest of the views (detail, results, vote) unchanged
```

## Viewã¨ãƒšãƒ¼ã‚¸ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’åˆ‡ã‚Šé›¢ã™

Viewã§ã¯ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚„æ“ä½œã‚’å°‚é–€çš„ã«è¡Œã£ã¦ã‚‚ã‚‰ã„ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆhtmlã«Pythonã®å¤‰æ•°ã‚’å…¥ã‚Œã‚‰ã‚Œã‚‹ã€‚ï¼‰ã«æ¸¡ã—ã¦ãƒšãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã‚‚ã‚‰ã†ã‚ˆã†ã«ã™ã‚‹ã€‚

pollsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«ã€templatesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚ã‚·ã‚¹ãƒ†ãƒ ã§ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èªè­˜ã™ã‚‹ã€‚ä½œæˆã—ãŸ templatesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«pollsãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã™ã‚‹ã€‚ãªã®ã§ `polls/templates/polls` ã¿ãŸã„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå®Œæˆã™ã‚‹ã€‚ãã®ä¸­ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ `index.html` ã‚’ä½œæˆã™ã‚‹ã€‚ãªãœ `templates/polls` ã¨ã™ã‚‹ã®ã‹ã¨ã„ã†ã¨Djangoã¯åå‰ãŒãƒãƒƒãƒã—ãŸæœ€åˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã€ã‚‚ã—ç•°ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­ã«åŒã˜åå‰ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚‹ã¨ãã¡ã‚‰ã‚’èª­ã¿è¾¼ã‚€ã€‚ãã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«åå‰ç©ºé–“ï¼ˆæ‰€å±ã™ã‚‹é ˜åŸŸï¼‰ã‚’ä¸ãˆã¦ã„ã‚‹ã€‚

`views.py` ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã€‚ 

```python
from django.http import HttpResponse
from django.template import loader

from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€
    template = loader.get_template('polls/index.html')
    # è¾æ›¸å‹ã«æœ€æ–°5ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ã€‚
    context = {
        'latest_question_list': latest_question_list,
    }
    # è¾æ›¸å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ¸¡ã—ã¦ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚ãã®çµæœã‚’HttpResponseã«è¿”ã™ã€‚
    return HttpResponse(template.render(context, request))
```

### view.pyã‚’ã•ã‚‰ã«çŸ­ãã™ã‚‹ã€‚

`from django.template import loader` 

`from django.http import HttpResponse`

ã‚’ä½¿ã‚ãªã„æ›¸ãæ–¹

ã‚ˆã‚Šç°¡ç´ ã«ã™ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã€‚

ãã®å ´åˆã€ `render()` é–¢æ•°ã¯ç¬¬ä¸€å¼•æ•°ã« `requestã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ` , ç¬¬äºŒå¼•æ•°ã« `ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå` , ç¬¬ä¸‰å¼•æ•°ã« `è¾æ›¸å‹ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ¸¡ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ï¼‰` ã‚’è¨˜è¿°ã™ã‚‹ã€‚

```python
from django.shortcuts import render
from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)
```

### 404ã‚¨ãƒ©ãƒ¼ã‚’å‡ºåŠ›ã™ã‚‹ã€‚

```python
from django.http import Http404
from django.shortcuts import render

from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)

# è³ªå•ã®è©³ç´°ãƒšãƒ¼ã‚¸ã®ãƒ“ãƒ¥ãƒ¼
def detail(request, question_id):
    try:
        # ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚ã£ãŸURLã§pkã®å€¤ãŒå¤‰ã‚ã‚‹ã€‚/polls/1/ãªã‚‰1ã«ãªã‚‹ã€‚
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¨Http404ã‚’å‡ºåŠ›ã™ã‚‹ã€‚
        question = Question.objects.get(pk=question_id)
    except Question.DoesNotExist:
        raise Http404("Question does not exist")
    return render(request, 'polls/detail.html', {'question': question})
```

### ä¸Šè¨˜ã®detail()ã‚’çŸ­ãã™ã‚‹ã€‚

`django.shortcuts` ã«ã¯ã“ã†ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’çœç•¥ã™ã‚‹é–¢æ•°ãŒå¤šãã‚ã‚‹ã®ã§èª¿ã¹ã‚‹ã¨é¢ç™½ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

```python
from django.shortcuts import get_object_or_404, render

from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)ã€‚

# ãƒ¢ãƒ‡ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹objects.get()ã¨Http404ãŒä¸€ç·’ã«ãªã£ã¦ã„ã‚‹ã€‚
def detail(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    return render(request, 'polls/detail.html', {'question': question})
```

### index.html

`index()` ã«å¯¾ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¯ã“ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã€‚

ãƒ“ãƒ¥ãƒ¼ã§ `latest_question_list` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¾æ›¸å‹ã«æ ¼ç´ã•ã‚Œã¦æ¸¡ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’å—ã‘å–ã£ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ ¼ç´ã•ã‚ŒãŸå€¤ã‚’å±æ€§ã‚¢ã‚¯ã‚»ã‚¹ `.` ã—ã¦å–å¾—ã—ã¦ã„ã‚‹ã€‚

```html
<!-- å—ã‘å–ã£ãŸå¤‰æ•°ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚ -->
{% if latest_question_list %}
    <ul>
    {% for question in latest_question_list %}
        <li><a href="/polls/{{ question.id }}/">{{ question.question_text }}</a></li>
    {% endfor %}
    </ul>
{% else %}
    <p>No polls are available.</p>
{% endif %}
```

### index.htmlã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆç›´æ¥è¨˜è¿°ã—ã¦ã„ã‚‹ï¼‰ã‚’å‰Šé™¤ã™ã‚‹

ã“ã®ã‚ˆã†ã«ç›´æ¥URLã‚’æ›¸ãè¾¼ã‚€ã¨å¤‰æ›´ã«å¼±ã„ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ `polls.urlsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®path()` é–¢æ•°ã§nameå¼•æ•°ã‚’å®šç¾©ã—ãŸã®ã§ãã‚Œã‚’URLã«ä½¿ç”¨ã™ã‚‹ã€‚  `{%url%}` ã‚’ä½¿ã†ã€‚

```html
<li><a href="/polls/{{ question.id }}/">{{ question.question_text }}</a></li>
```

å¤‰æ›´å¾Œ

```html
<li><a href="{% url 'detail' question.id %}">{{ question.question_text }}</a></li>
```

ãã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…¥ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ãŸéš›ã®ã‚ˆã†ã«åå‰ç©ºé–“ã‚’è¿½åŠ ã™ã‚‹ã€‚ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ¥ã€…ã®ã‚¢ãƒ—ãƒªå†…ã§åŒã˜nameå¼•æ•°ã‚’å«ã‚“ã§ã„ã¦ã‚‚åŒºåˆ¥ãŒä»˜ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã« `template/polls/detail.html` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„å ´åˆã¯  `polls:detail` ã¨è¨˜è¿°ã™ã‚‹ã€‚

```html
<!-- å—ã‘å–ã£ãŸå¤‰æ•°ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚ -->
{% if latest_question_list %}
    <ul>
    {% for question in latest_question_list %}
       <li><a href="{% url 'polls:detail' question.id %}">{{ question.question_text }}</a></li>
    {% endfor %}
    </ul>
{% else %}
    <p>No polls are available.</p>
{% endif %}
```

ãã—ã¦ã€URLconfï¼ˆurls.pyï¼‰ã«åå‰ç©ºé–“ã‚’è¿½åŠ  `app_name = 'polls'`

```python
from django.urls import path

from . import views

# ã“ã“ã‚’æ–°ãŸã«è¿½åŠ ã—ãŸã€‚
app_name = 'polls'
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:question_id>/', views.detail, name='detail'),
    path('<int:question_id>/results/', views.results, name='results'),
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
```

ã“ã†ã™ã‚‹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æŒ‡å®šã•ã‚ŒãŸURLã®å®šç¾©ã‚’æ¤œç´¢å‡ºæ¥ã‚‹ã€‚ä¾‹ãˆã° `polls/specifics/12` ã®ã‚ˆã†ã«URLã‚’å¤‰æ›´ã—ãŸå ´åˆ

`urls.py` ã«æ›¸ã‹ã‚ŒãŸãƒ‘ã‚¹ã‚’å¤‰æ›´ã™ã‚‹äº‹ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã«å¤‰æ›´ã‚’åŠ ãˆã‚‹å¿…è¦ãŒãªã„ã€‚

```python
path('specifics/<int:question_id>/', views.detail, name='detail'),
```

### detail.html

`detail()` ã«å¯¾ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã“ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã€‚

```html
<h1>{{ question.question_text }}</h1>
<ul>
{% for choice in question.choice_set.all %}
    <li>{{ choice.choice_text }}</li>
{% endfor %}
</ul>
```

## ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ã¦è³ªå•ã«å¯¾ã—ã¦å›ç­”ã‚’é€ä¿¡ã™ã‚‹ã€‚

`detail.html` ã« `<form>` ã‚’è¿½åŠ ã—ã¦ã‚µãƒ¼ãƒã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¦è³ªå•ã«å¯¾ã—ã¦ã€æŠ•ç¥¨å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

ä¸‹è¨˜ã®ã‚ˆã†ã« `detail.html` ã‚’å¤‰æ›´ã™ã‚‹ã€‚

```html
<!-- è³ªå•ã®å†…å®¹ -->
<h1>{{ question.question_text }}</h1>

<!-- ã‚‚ã—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è³ªå•ãŒå–å¾—å‡ºæ¥ãªã„å ´åˆã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚ -->
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url 'polls:vote' question.id %}" method="post">

<!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ -->
{% csrf_token %}

<!-- è³ªå•ã«å¯¾ã™ã‚‹é¸æŠè‚¢ã‚’ä¸¦ã¹ã‚‹ -->
{% for choice in question.choice_set.all %}
    <!-- forloop.counterã¯forã‚¿ã‚°ã®ãƒ«ãƒ¼ãƒ—ãŒä½•åº¦å®Ÿè¡Œã•ã‚ŒãŸã‹ã‚’è¡¨ã™å€¤ã§ã™ã€‚ -->
    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}">
    <label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br>
{% endfor %}
<input type="submit" value="Vote">
</form>
```

## views.pyã«vote()é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹

ã‚³ãƒ¼ãƒ‰ã®æµã‚Œã¨ã—ã¦ã¯

1. ãƒ¦ãƒ¼ã‚¶ãŒdetailãƒšãƒ¼ã‚¸ã®è³ªå•ã«å¯¾ã™ã‚‹é¸æŠè‚¢ã‚’é¸æŠã™ã‚‹ã€‚
2. Voteãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
3. ãƒ‡ãƒ¼ã‚¿ãŒã‚µãƒ¼ãƒã«é€ä¿¡ã•ã‚Œã‚‹ã€‚
4. é¸æŠã•ã‚ŒãŸé¸æŠè‚¢ã®æŠ•ç¥¨æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã€‚
5. results.htmlã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã€‚Postãƒ‡ãƒ¼ã‚¿ãŒæˆåŠŸã—ãŸå¾Œã¯åŸºæœ¬çš„ã« `HttpResponse` ã§ã¯ãªã `HttpResponseRedirect` ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ã€‚

 

```python
# è¿½åŠ ã—ãŸã€‚HttpResponse, HttpResponseRedirect
from django.http import HttpResponse, HttpResponseRedirect
from django.shortcuts import get_object_or_404, render
# è¿½åŠ ã—ãŸã€‚reverse
from django.urls import reverse
# Choiceã‚’è¿½åŠ ã—ãŸã€‚
from .models import Choice, Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)ã€‚

# ãƒ¢ãƒ‡ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹objects.get()ã¨Http404ãŒä¸€ç·’ã«ãªã£ã¦ã„ã‚‹ã€‚
def detail(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    return render(request, 'polls/detail.html', {'question': question})

# è³ªå•ã«å¯¾ã—ã¦é¸æŠã—ã¦æŠ•ç¥¨ã™ã‚‹ã€‚
def vote(request, question_id):
    # ã¾ãšè³ªå•ãŒã‚ã‚‹ã‹ã©ã†ã‹ç¢ºèªã™ã‚‹ã€‚
    question = get_object_or_404(Question, pk=question_id)
    try:
        # ãƒ¦ãƒ¼ã‚¶ãŒé¸æŠã—ãŸå€¤ã‹ã‚‰pkå€¤ã‚’å–å¾—ã—ã¦ã€ãã‚Œã‚’å…ƒã«ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰é¸æŠè‚¢ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚
        # ãªã‘ã‚Œã°You didn't...choiceã¨è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
        selected_choice = question.choice_set.get(pk=request.POST['choice'])
    except (KeyError, Choice.DoesNotExist):
        # Redisplay the question voting form.
        return render(request, 'polls/detail.html', {
            'question': question,
            'error_message': "You didn't select a choice.",
        })
    else:
        # é¸æŠè‚¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ä½•å›æŠ•ç¥¨ã•ã‚ŒãŸã‹è¡¨ç¤ºã™ã‚‹votesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã€‚
        selected_choice.votes += 1
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ã€‚
        selected_choice.save()
        # Always return an HttpResponseRedirect after successfully dealing
        # with POST data. This prevents data from being posted twice if a
        # user hits the Back button.
        # ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«æˆåŠŸã—ãŸã‚‰ã€results.htmlã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã€‚
        return HttpResponseRedirect(reverse('polls:results', args=(question.id,)))
```

### reverse()é–¢æ•°ã¨ã¯

ã“ã®é–¢æ•°ã‚’ä½¿ã†ã¨ã€voteé–¢æ•°ä¸­ã§ã®URLã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’é˜²ãäº‹ãŒå‡ºæ¥ã‚‹ã€‚

å¼•æ•°ã¨ã—ã¦ã¯ `polls:results` ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®ãƒ“ãƒ¥ãƒ¼åã¨ãã®ãƒ“ãƒ¥ãƒ¼ã«ä¸ãˆã‚‹URLãƒ‘ã‚¿ãƒ¼ãƒ³ `question.id` ã‚’æ¸¡ã›ã‚‹ã€‚

```python
reverse('polls:results', args=(question.id,))

# è¿”ã‚Šå€¤
'/polls/3/results/'
```

## Posté€šä¿¡ãŒæˆåŠŸã—ãŸéš›ã®resultsé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚

views.pyã«resultsé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã€‚

```python
# å…ˆã»ã©ã¾ã§æ›¸ã„ã¦ããŸviews.pyã«resultsé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã€‚

def results(request, question_id):
    # æŒ‡å®šã—ãŸpkã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¿”ã™ã€ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚
    question = get_object_or_404(Question, pk=question_id)
    # è³ªå•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã§è²°ã£ã¦ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚
    return render(request, 'polls/results.html', {'question': question})
```

results.htmlã‚’ä½œæˆã™ã‚‹ã€‚

```html
<!-- è³ªå•ã‚’è¡¨ç¤ºã™ã‚‹ã€‚ -->
<h1>{{ question.question_text }}</h1>

<!--è³ªå•ã®é¸æŠè‚¢ã¨ãã‚Œã«å¯¾ã™ã‚‹æŠ•ç¥¨æ•°ã‚’å–å¾—ã™ã‚‹ã€‚-->
<ul>
{% for choice in question.choice_set.all %}
    <!--choice.votes|pluralizeã¯æŠ•ç¥¨æ•°ãŒ2ä»¥ä¸Šã®å ´åˆvote s ã¨sã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹ã€‚-->
    <li>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}</li>
{% endfor %}
</ul>

<a href="{% url 'polls:detail' question.id %}">Vote again?</a>
```

[Built-in template tags and filters | Django documentation | Django](https://docs.djangoproject.com/en/dev/ref/templates/builtins/?from=olddocs#pluralize)

## æ±ç”¨ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ä»Šã¾ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ã•ã‚‰ã«çŸ­ãã™ã‚‹ã€‚

`views.py` ã«æ›¸ã‹ã‚ŒãŸ `index(), detail(), results()` é–¢æ•°ã¯3ã¤ã¨ã‚‚ä¼¼ãŸã‚ˆã†ãªæ©Ÿèƒ½ã§URLã‚’ä»‹ã—ã¦æ¸¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¾“ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚ã“ã‚Œã‚‰ã®ä¸€é€£ã®å‹•ä½œã¯ã‚ˆãã‚ã‚‹äº‹ãªã®ã§Djangoã§ã¯æ±ç”¨ãƒ“ãƒ¥ãƒ¼ã¨ã„ã†ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ç”¨æ„ã—ã¦ã‚ˆã‚Šç°¡ç´ ã«æ©Ÿèƒ½ã‚’å®Ÿè£…å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

æ±ç”¨ãƒ“ãƒ¥ãƒ¼ã‚’é©ç”¨ã™ã‚‹ã«ã¯ã„ãã¤ã‹ã“ã‚Œã¾ã§ã«æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

1. URLconfã‚’å¤‰æ›ã™ã‚‹ã€‚
2. å¤ã„ä¸è¦ãªãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ã€‚
3. æ–°ã—ã„ãƒ“ãƒ¥ãƒ¼ã«Djangoæ±ç”¨ãƒ“ãƒ¥ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

### URLconfã®ä¿®æ­£

å¤‰æ›´å‰

```python
from django.urls import path

from . import views

app_name = 'polls'
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:question_id>/', views.detail, name='detail'),
    path('<int:question_id>/results/', views.results, name='results'),
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
```

å¤‰æ›´å¾Œ

```python
from django.urls import path

from . import views

app_name = 'polls'
urlpatterns = [
    path('', views.IndexView.as_view(), name='index'),
    path('<int:pk>/', views.DetailView.as_view(), name='detail'),
    path('<int:pk>/results/', views.ResultsView.as_view(), name='results'),
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
```

`views.IndexView.as_view(), views.DetailView.as_view(), views.ResultsView.as_view()` ã¨ `as_view()` ã¨æ›¸ãã‚ˆã†ã«ãªã£ãŸã€‚

ãã—ã¦ã€ `question_id` ãŒ `pk` ã«å¤‰æ›´ã•ã‚ŒãŸã€‚ã“ã“ã¯åŒã˜ã§ã‚‚ã„ã„ã‚ˆã†ãªæ°—ã‚‚ã™ã‚‹ã€‚çµå±€åŒã˜æ•°å€¤ãŒè¿”ã‚Šå€¤ã¨ã—ã¦å…¥ã‚‹ã‹ã‚‰ã€‚

â€»å¾Œè¿°ã™ã‚‹ `DetailView` ã«ã¯ `pk` ã‚­ãƒ¼ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ã®ã§åŒã˜ã§ã¯ãƒ€ãƒ¡ãªã‚ˆã†ã ã€‚

### viewsã®ä¿®æ­£

`index(), detail(), results()` é–¢æ•°ã‚’å‰Šé™¤ã—ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã«æ›¸ãæ›ãˆã‚‹ã€‚

indexã§ã¯ `ListView` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã€‚

detail, resultsã§ã¯ `DetailView` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã€‚

*ListView*

ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã€‚ã€

ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç¶™æ‰¿ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸‹è¨˜ã®é †ç•ªã§è‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

1.[setup()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/base/#django.views.generic.base.View.setup)
2.[dispatch()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/base/#django.views.generic.base.View.dispatch)
3.[http_method_not_allowed()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/base/#django.views.generic.base.View.http_method_not_allowed)
4.[get_template_names()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/mixins-simple/#django.views.generic.base.TemplateResponseMixin.get_template_names)
5.[get_queryset()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/mixins-multiple-object/#django.views.generic.list.MultipleObjectMixin.get_queryset)
6.[get_context_object_name()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/mixins-multiple-object/#django.views.generic.list.MultipleObjectMixin.get_context_object_name)
7.[get_context_data()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/mixins-multiple-object/#django.views.generic.list.MultipleObjectMixin.get_context_data)
8.[get()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/generic-display/#django.views.generic.list.BaseListView.get)
9.[render_to_response()](https://docs.djangoproject.com/ja/3.2/ref/class-based-views/mixins-simple/#django.views.generic.base.TemplateResponseMixin.render_to_response)

ã“ã®ã‚ˆã†ã«ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã« `get_quesryset()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦å†…å®¹ã‚’ä¸Šæ›¸ãã™ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã€‚

**template_name**

`ListView` ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å ´åˆ `<app name>/<model name>_list.html` ã‚’è‡ªå‹•ã§ç”Ÿæˆã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚

ãã®å ´åˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã¯ `polls/question_list.html` ã«ãªã‚‹ã€‚

ã—ã‹ã—å…ƒã€…ä½œæˆã—ã¦ã‚ã‚‹ `polls/index.html` ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ `template_name` ã« `'polls/detail.html'` ã‚’ä»£å…¥ã™ã‚‹äº‹ã§DjangoãŒãã¡ã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«èªè­˜ã—ã¦ãã‚Œã‚‹ã€‚

*DetailView*

ã€Œã‚ã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€‚ã€

ãªã®ã§ ListViewã®è©³ç´°ãƒšãƒ¼ã‚¸ã‚’DetailViewã§è¡¨ç¤ºã™ã‚‹ã¿ãŸã„ãªä½¿ã‚ã‚Œæ–¹ã‚’ã™ã‚‹ã€‚

**template_name**

ãã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `DetailView` ã¯ `<app name>/<model name>_detail.html` ã¨ã„ã†åå‰ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚

ãã®å ´åˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã¯ `polls/question_detail.html` ã«ãªã‚‹ãŒã€ä»Šå›ã¯è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã§ã¯ãªãå…ƒã€…ä½œæˆã—ã¦ã‚ã‚‹ `polls/detail.html` ã‚’ä½¿ã„ãŸã„ã®ã§ `template_name` ã‚’æŒ‡å®šã—ã¦å…ƒã€…ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã€‚æ–¹æ³•ã¯ListViewã®æ™‚ã¨åŒã˜ã§ `template_name` ã« `polls/detail.html` ã‚’ä»£å…¥ã™ã‚‹ã€‚

```python
from django.http import HttpResponseRedirect
from django.shortcuts import get_object_or_404, render
from django.urls import reverse
from django.views import generic

from .models import Choice, Question

class IndexView(generic.ListView):
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ç”¨ã›ãšã€å…ƒã€…ä½œæˆã—ã¦ã‚ã£ãŸã‚‚ã®ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
    template_name = 'polls/index.html'
    # è‡ªå‹•ã§æ¸¡ã•ã‚Œã‚‹question_listã¨ã„ã†ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ•°ã®å¤‰æ•°åã‚’ç‹¬è‡ªã®ã‚‚ã®ã«å¤‰æ›´ã—ã¦ã„ã‚‹ã€‚
    context_object_name = 'latest_question_list'

    def get_queryset(self):
        """æœ€æ–°ã®5ä»¶ã‚’å–å¾—ã™ã‚‹ã€‚"""
        return Question.objects.order_by('-pub_date')[:5]

class DetailView(generic.DetailView):
    # è‡ªåˆ†ãŒã©ã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦å‹•ä½œã™ã‚‹ã‹ã‚’ä¼ãˆã¦ã„ã‚‹ã€‚
    # ãŠãã‚‰ãget_object_or_404(Question, pk=question_id)ã®Questionéƒ¨åˆ†ã‚’æ‹…ã£ã¦ã„ã‚‹ã€‚
    # pkã®éƒ¨åˆ†ã¯urls.pyã§å…ˆã«æŒ‡å®šã—ã¦ã‚ã‚‹ã€‚
    model = Question
    template_name = 'polls/detail.html'

class ResultsView(generic.DetailView):
    model = Question
    template_name = 'polls/results.html'

def vote(request, question_id):
    ... # å‰å›ã®ã¾ã¾å¤‰æ›´ã—ãªã„ã€‚
```

ã“ã‚Œã§ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ç‰¹ã«ã‚¨ãƒ©ãƒ¼ã‚‚ãªãè³ªå•ã®ãƒªã‚¹ãƒˆãƒšãƒ¼ã‚¸ï¼ˆindex.htmlï¼‰ã€è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆæŠ•ç¥¨ã™ã‚‹ãƒšãƒ¼ã‚¸detail.htmlï¼‰ã€æŠ•ç¥¨å¾Œã®ä»Šã¾ã¾ã§ã®æŠ•ç¥¨æ•°ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ï¼ˆresults.htmlï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°æ±ç”¨ãƒ“ãƒ¥ãƒ¼ã§ã®ã‚¢ãƒ—ãƒªæ§‹ç¯‰ãŒã§ããŸã¨æ€ã†ã€‚

## æœ€å¾Œã«

éå»ã«Ruby on railsã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸­èº«ãŒã©ã†å‹•ä½œã—ã¦ã„ã‚‹ã®ã‹ã‚¤ãƒ¡ãƒ¼ã‚¸å‡ºæ¥ãªã„ã®ãŒè‹¦ç—›ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯é¢å€’ãªä¸­èº«ã‚’æ°—ã«ã—ãªãã¦ã‚‚ã‚¢ãƒ—ãƒªãŒä½œã‚Œã‚‹ã‚ˆã†ã«è¨­è¨ˆã—ã¦ã‚ã‚‹ã®ã§ä»•æ–¹ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ï¼‰ã§æŒ«æŠ˜ã—ã¦ã„ã‚‹ã®ã§ä»Šå›Djangoã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¾ã é€”ä¸­ã§ã™ãŒæŒ«æŠ˜ã›ãšã«ã‚¢ãƒ—ãƒªä½œæˆã¾ã§å‡ºæ¥ã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚æ™®æ®µJsonã—ã‹è§¦ã‚‰ãªã‹ã£ãŸã®ã§å°‘ã—ã§ã™ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦æ“ä½œã™ã‚‹çµŒé¨“ãŒå‡ºæ¥ãŸã®ã§ã“ã‚Œã‚’æ°—ã«SQLæ§‹æ–‡ã‚’ã‚‚ã†å°‘ã—å‹‰å¼·ã—ã‚ˆã†ã¨æ€ã†ã€‚å¤šå¯¾å¤šã€å¤šå¯¾ä¸€ã®é–¢ä¿‚ã¨ã‹ã‚‚è‡ªåˆ†ã§ä½œæˆå‡ºæ¥ã‚‹ã¾ã§ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã®ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã®ERå›³ã‚’ã‹ã‘ã‚‹æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ã€‚

### å‚ç…§

[SECRET_KEYã‚’èª¤ã£ã¦GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã¨ãã®å¯¾å‡¦æ³•ï¼ˆDjangoç·¨ï¼‰ - Qiita](https://qiita.com/frosty/items/bb5bc1553f452e5bb8ff)

[Pythonã®ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ä¸Šä½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š | note.nkmk.me](https://note.nkmk.me/python-relative-import/)

[ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ(import *)ã¯æ¨å¥¨ã•ã‚Œãªã„](https://python.civic-apps.com/wildcard-import/)

[ã€Œã‚«ãƒ©ãƒ åã€ã¨ã€Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€ã®é•ã„ï½œã€Œåˆ†ã‹ã‚Šãã†ã€ã§ã€Œåˆ†ã‹ã‚‰ãªã„ã€ã§ã‚‚ã€Œåˆ†ã‹ã£ãŸã€æ°—ã«ãªã‚Œã‚‹ITç”¨èªè¾å…¸](https://wa3.i-3-i.info/diff529name.html)

[3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | densan-labs.net](https://densan-labs.net/tech/codefirst/migration.html)

[ãƒ¢ãƒ‡ãƒ«(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)ã®ä½œæˆ](https://codor.co.jp/django/making-model)

[ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚ˆãè¦‹ã‹ã‘ã‚‹"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ(context)ã£ã¦ä½•ï¼Ÿ - Qiita](https://qiita.com/dojyorin/items/0bd3ef167991cfc703b1)

[Python Django ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«(3) - Qiita](https://qiita.com/maisuto/items/eece9d880d94fd241a0d)

[DJangoã®ãŠå‹‰å¼·(1) - Qiita](https://qiita.com/ShimantoAkira/items/ec1130fbd2a65cd5b7f3)

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.djangoproject.com/ja/3.2/intro/)

è¨˜äº‹ã«é–¢ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆç­‰ã¯

ğŸ•Šï¼š[Twitter](https://twitter.com/Unemployed_jp)
ğŸ“ºï¼š[Youtube](https://www.youtube.com/channel/UCT3wLdiZS3Gos87f9fu4EOQ/featured?view_as=subscriber)
ğŸ“¸ï¼š[Instagram](https://www.instagram.com/unemployed_jp/)
ğŸ‘¨ğŸ»â€ğŸ’»ï¼š[Github](https://github.com/wimpykid719?tab=repositories)
ğŸ˜¥ï¼š[Stackoverflow](https://ja.stackoverflow.com/users/edit/22565)

ã§ã‚‚å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚ã©ã“ã‹ã«ã¯ã„ã¾ã™ã€‚