---
title: "Next.jsã®APIæ©Ÿèƒ½ã‚’ä½¿ã£ã¦Qiitaã®æŠ•ç¨¿è¨˜äº‹ã‚’Zennã¿ãŸã„ã«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰è‡ªå‹•æŠ•ç¨¿ãƒ»æ›´æ–°ã€ç®¡ç†å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ãŸã€‚" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸ¦‘" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["nextjs", "react", "typescript", "api", "vercel"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
date: '2021.06.21'
---

## æœ€åˆã«

å‰å›Next.jsã¨Vercelã‚’ä½¿ç”¨ã—ã¦ã€Zennã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã‚’å–å¾—ã—ã¦ä½œã‚‹[techBlog](https://zenn.dev/unemployed/articles/nextjs-build-techblog)ã‚’ä½œæˆã—ãŸã€‚ä»Šå›ã¯Qiitaã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã‚‚å–å¾—ã—ã¦ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ã«åŠ ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½è¿½åŠ ã¨ã©ã†ã›ãªã‚‰ã¨ã„ã†äº‹ã§Qiitaã®è¨˜äº‹ã‚’Githubãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã«æ›´æ–°ãŒã‚ã£ãŸã‚‰è‡ªå‹•ã§Qiitaã«æŠ•ç¨¿ã•ã‚Œã‚‹ã‚ˆã†ã«Zennã¿ãŸã„ãªæ©Ÿèƒ½è¿½åŠ ã‚’è¡Œã„ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## è¿½åŠ æ©Ÿèƒ½

techBlogã«æ–°ãŸã«è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ã‚’ã¾ã¨ã‚ã¦ã¿ãŸã€‚

- Zennã¿ãŸã„ã«é€£æºã—ãŸãƒªãƒã‚¸ãƒˆãƒªã«è¨˜äº‹ã‚’è¿½åŠ ã—ãŸã‚‰Qiitaã«æŠ•ç¨¿ãƒ»æ›´æ–°ã‚’è¡Œã†ã€‚
- Qiitaã«æŠ•ç¨¿ã—ã¦ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ã«ã™ã‚‹ã€‚

## å¿…è¦ãªç‰©

- qiitaã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- ãƒªãƒã‚¸ãƒˆãƒªã«webhookã®è¨­å®šã‚’ã™ã‚‹
- githubã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆtechBlogä½œæˆã®éš›ã«å–å¾—ã—ãŸã€‚ï¼‰

## qiitaã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—

[å€‹äººã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ](https://qiita.com/settings/tokens/new) Qiitaã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã“ã“ã‹ã‚‰ä½œæˆã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

è¨­å®š > ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ > æ–°ã—ããƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹ã§ã‚‚ä¸Šè¨˜ã®ãƒªãƒ³ã‚¯ãƒšãƒ¼ã‚¸ã«ã„ã‘ã¾ã™ã€‚

æ¨©é™ã¯ `read_qiita` ã¨ `write_qiita` ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚

ã‚ã¨ã¯ç™ºè¡Œã™ã‚‹ã‚’æŠ¼ã™ã¨å‡ºã¦ãã‚‹ã€‚è¡¨ç¤ºã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã®ã§ã€ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã€‚

## Qiitaã®è¨˜äº‹ã‚’ç®¡ç†ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®webhookè¨­å®š

webhookã¨ã¯ä½•ã‹ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ããŸéš›ã«å¤–éƒ¨ã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ãã‚Œã‚‹æ©Ÿèƒ½ã§ã“ã‚Œã®ãŠã‹ã’ã§åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹åŒå£«ã‚’é€£æºã•ã›ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚‹ã€‚

ãƒªãƒã‚¸ãƒˆãƒªã«webhookè¨­å®šã™ã‚‹ã«ã¯Githubã§webhookã‚’è¨­å®šã—ãŸã„ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã«è¡Œã£ã¦ > settings > webhooksã§è¨­å®šã§ãã‚‹ã€‚

### ã‚¤ãƒ™ãƒ³ãƒˆã¨ã¯

ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯Githubã®å ´åˆã¯pushã«ã‚ˆã‚Šãƒªãƒã‚¸ãƒˆãƒªã®æ›´æ–°ç­‰ãŒè©²å½“ã™ã‚‹ã€‚

ä»–ã«ã‚‚ `Send me everything.` ã‚„ `Let me select individual events.` ç­‰ç´°ã‹ãè¨­å®šã§ãã‚‹ã‚ˆã†ã ãŒã€webhookã‚’æŠ•ã’ã¦æ¬²ã—ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯pushæ™‚ã®ã¿ãªã®ã§ `Just the push event.` ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚

![webhookè¨­å®š](https://user-images.githubusercontent.com/23703281/122698234-d91b6f00-d281-11eb-8cf3-222e237fbe91.png)

### Payload URL

ã“ã‚Œã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦æ¬²ã—ã„å¤–éƒ¨URLã§ã‚ã‚‹ã€‚

è‡ªåˆ†ã®å ´åˆã¯ `https://techblog-pink.vercel.app/api/qiita-post` ã“ã“ã«APIã‚’ç«‹ã¦ã‚‹ã®ã§ã€ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚

### Content type

ã“ã‚Œã¯ãŠãã‚‰ããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹éš›ã«ä¸€ç·’ã«é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ—ã«ãªã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€Jsonå½¢å¼ã§é€ã£ã¦æ¬²ã—ã„ã®ã§ `application/json` ã‚’é¸æŠã™ã‚‹ã€‚

`application/x-www-form-urlencoded` ã¯URLã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¹—ã›ã¦é€ä¿¡ã™ã‚‹ã€‚

POSTãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚‚URLã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¹—ã›ã‚Œã‚‹ã‚“ã§ã™ã­ã€‚ ãã†ã„ã†äº‹ã™ã‚‹ã®GET ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚‹ã€‚

ã“ã‚Œã§webhookã®è¨­å®šã¯å®Œäº†ã—ãŸã®ã§ã‚ã¨ã¯ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã€‚

ã¨è¨€ã£ã¦ã‚‚ã™ã§ã«å®Œæˆã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ã‚’ã—ã¦ã„ã“ã†ã¨æ€ã†ã€‚

## Next.jsã«APIã‚’ç«‹ã¦ã‚‹ã€‚

`pages/api/qiita-post.ts` ã¨ã„ã†ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹äº‹ã§APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’Next.jsã§ã¯ä½œæˆã§ãã‚‹ã€‚

ã‚ã¨ã¯ã“ã“ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã£ãŸéš›ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ãäº‹ã«ãªã‚‹ã€‚

è¨˜è¿°å½¢å¼ã¯ node.jsã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯expressã¨åŒã˜ã ã¨æ€ã†ã€‚å€‹äººçš„ã«ã¯ä½¿ç”¨ã—ãŸäº‹ãªã„ã®ã§è©³ã—ãã¯åˆ†ã‹ã‚‰ãªã„ãŒã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§APIã‚’ä½œæˆã—ãŸéš›ã«

> [Connect/Express middleware support](https://nextjs.org/docs/api-routes/api-middlewares#connectexpress-middleware-support)

ã¨æ›¸ã‹ã‚Œã¦ã„ãŸã®ã§ Connectã¨Expressã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã ã¨æ€ã†ã€‚

ä½¿ã„æ–¹ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ `req` ã«webhookç­‰ã‹ã‚‰å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œ `req.body` ã§å–ã‚Šå‡ºã›ã‚‹ã€‚

 `res` ã¯webhookã‚’å‡ºã—ãŸã‚µãƒ¼ãƒã«è¿”ã™å€¤ã‚’è¨­å®šã§ãã‚‹ã€‚ä¸‹è¨˜ã®ä¾‹ã§ã¯ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰200ã§ `{ text: 'Helllo' }` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ã€‚

```tsx
import { NextApiRequest, NextApiResponse } from 'next'

export default (req: NextApiRequest, res: NextApiResponse) => {
  // ã“ã“ã«å‡¦ç†ã‚’è¿½åŠ ã—ã¦ã„ãã€‚
  res.status(200).json({ text: 'Hello' })
}
```

å®Ÿéš›ã«å®Ÿéš›ã«å‡¦ç†ã‚’è¿½åŠ ã—ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰

`qiita-post.ts`

```tsx
import type { NextApiRequest, NextApiResponse } from 'next'
import { getUpdatedFiles } from '../../lib/api/qiita'
import { makeQiitaArticle } from '../../lib/api/qiita'
import { postQiita } from '../../lib/api/qiita'
import { writeQiitaId } from '../../lib/api/qiita'
import { PushRes } from '../../types/Response'

export default async(req: NextApiRequest, res: NextApiResponse) => {
  
  if (req.method === 'POST') {
    const files = await getUpdatedFiles(req.body)
    console.log(`filesãƒ•ã‚£ãƒ«ã‚¿å‰ã®ä¸­èº«ï¼š${files[0]}`)
    console.log(`filesé•·ã•ï¼š${files.length}`)

    // udefinedãŒé…åˆ—ã«å«ã¾ã‚Œã‚‹ã®ã§å–ã‚Šé™¤ã
    const filesRemovedUndefined = files.filter(Boolean)
    console.log(`filesãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ä¸­èº«ï¼š${filesRemovedUndefined[0]}`)
    console.log(`filesãƒ•ã‚£ãƒ«ã‚¿å¾Œã®é•·ã•ï¼š${filesRemovedUndefined.length}`)
    // filesRemovedUndefinedã«å€¤ãŒã‚ã‚Œã°å‡¦ç†ã‚’ç¶šã‘ã‚‹ã€‚
    if (filesRemovedUndefined.length) {
      const statuses = await Promise.all(filesRemovedUndefined.map( async(file) => {
        //ã€€ã“ã“ã˜ã‚ƒãªã„
        const article = makeQiitaArticle(file)
        const qiitaPostRes = await postQiita(article, file.qiitaId)
        // falseã®å ´åˆã¯webhookã®2å›ç›®ã®é€šä¿¡ã«ãªã‚‹ã®ã§ã“ã“ã§å‡¦ç†ã‚’æ­¢ã‚ã‚‹ã€‚
        if (!qiitaPostRes) {
          // å¤šåˆ†ã“ã‚ŒãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ç‚¹ã§å‡¦ç†æ­¢ã¾ã‚‹æ°—ãŒã™ã‚‹ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”ã—ã¦ã‚‹ã‹ã‚‰
          return { status: 200, message: 'notting to upadate posts' }
        } else {
          // ä¸Šè¨˜ã®åˆ†å²ã§å¼•ã£æ›ã‹ã‚‰ãªã‘ã‚Œã°writeQiitaIdã‚’å®Ÿè¡Œã§ãã‚‹ã€‚
          const status: PushRes | string | undefined = await writeQiitaId(file, qiitaPostRes.id)
          // æ›¸ãæ›ãˆãŒæˆåŠŸã™ã‚Œã°ãã‚Œã‚’ä¼ãˆã‚‹
          if ('object' === typeof status) {
            if(status.commit.message) {}
            console.log(status.commit.message);
            // res.status(201).json({ status: `succeeded ${status.commit.message}` })
            return { status: 201, message: `succeeded ${status.commit.message}` }
          } else if('string' === typeof status) {
            // ã‚‚ã—repositoryã®æ›¸ãæ›ãˆãŒå¿…è¦ãªã„è¨˜äº‹ã®æ›´æ–°ã®å ´åˆã¯ãƒªãƒã‚¸ãƒˆãƒªã®æ›´æ–°ãŒå¿…è¦ãªã„ã®ã§
            // å‡¦ç†ã‚’æ­¢ã‚ãŸäº‹ã‚’ä¼ãˆã‚‹ã€‚
            return { status: 200, message: status }
          } else {
            // ãƒªãƒã‚¸ãƒˆãƒªã®æ›¸ãæ›ãˆã§ä½•ã‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸäº‹ã‚’ä¼ãˆã‚‹ã€‚
            return { status: 502, message: 'failed to update repository' }
          }
        }
      }))
      res.status(200).json( { allstatus: statuses} )
    } else {
      res.status(200).json( { status: 'noting to post' } )
    }
    
    //é€šä¿¡ãŒæˆåŠŸã—ãŸã‚‰statusã‚³ãƒ¼ãƒ‰201ã¨Jsonã‚’è¿”ã™ã€‚
    // res.status(201).json({ body: req.body })
  } else {
    res.status(200).json({ name: 'John Doe' })
  }
}
```

## å‡¦ç†ã®é †ç•ª

1. ãƒ¦ãƒ¼ã‚¶ã®pushã«ã‚ˆã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®æ›´æ–°ã€‚
2. webhookã‹ã‚‰HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹ã€‚
3. getUpdatedFiles() é–¢æ•°ãŒæ–°è¦æŠ•ç¨¿ãƒ»æ›´æ–°äºˆå®šã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ `[object, object,...]` ã®å½¢ã§è¿”ã™ã€‚
4. è¿”ã•ã‚ŒãŸé…åˆ—ã« `undefined` ã‚‚å«ã¾ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’å–ã‚Šé™¤ã„ã¦ã€mapé–¢æ•°ã§ä¸€ã¤ãšã¤ã«ã—ã¦ makeQiitaAriticle() é–¢æ•°ã«æ¸¡ã—ã€è¿”ã‚Šå€¤ã¨ã—ã¦qiitaã«æŠ•ç¨¿ã™ã‚‹éš›ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã—ã¦è¿”ã—ã¦ãã‚Œã‚‹ã€‚
5. postQiita() é–¢æ•°ã«å…ˆã»ã©ä½œæˆã—ãŸqiitaã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨æ›´æ–°ã®å ´åˆã«å¿…è¦ã«ãªã‚‹ã€è¨˜äº‹ã®IDã‚’æ¸¡ã™ã€‚æ›´æ–°ãƒ»æŠ•ç¨¿ã—ãŸå ´åˆã¯qiitaã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚è¨˜äº‹è‡ªä½“ã«å¤‰æ›´ãŒãªãæ›´æ–°ã™ã‚‹å¿…è¦ãŒãªã„å ´åˆã¯ `false` ã‚’è¿”ã™ã€‚ã“ã‚Œã¯å¾Œè¿°ã§å‡ºã¦ãã‚‹writeQiitaId() é–¢æ•°ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã«pushã™ã‚‹éš›ã«webhookãŒå†ã³èµ°ã‚‹ã€‚å†ã³writeQiitaId()ãŒå®Ÿè¡Œã•ã‚Œpushã‚’æŠ•ã’ã‚‹ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹ãŸã‚ã«falseã‚’è¿”ã—ã¦ã„ã‚‹ã€‚ãªã®ã§æœ€ä½ã§ã‚‚2å›ã€webhookèµ°ã‚‹ã€‚
6. writeQiitaId() ã¯æ–°è¦æŠ•ç¨¿ã®éš›ã«ç”Ÿæˆã•ã‚ŒãŸqiitaIdã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹è¨˜äº‹ã® `.md` ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã€‚
7. ãã—ã¦æœ€å¾Œã«å‡¦ç†ãŒä¸Šæ‰‹ãè¡Œã£ãŸã©ã†ã‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚

## getUpdatedFiles()

qiita.tsã«æ›¸ã‹ã‚ŒãŸé–¢æ•°ã‚’ä¸€ã¤ãšã¤ç´¹ä»‹æŒ‡å®šã“ã†ã¨æ€ã†ã€‚ã‚ã¾ã‚Šç¶ºéº—ãªè¨­è¨ˆã¨ã¯è¨€ãˆãªã„ã€ãƒ–ã‚µã‚¤ã‚¯ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ãŒä»Šå¾Œãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ãªãŒã‚‰ç¶ºéº—ã«ã—ã¦ã„ããŸã„ã¨æ€ã†ã€‚

```tsx
//1 githubã‹ã‚‰æŠ•ç¨¿ãƒ»æ›´æ–°ã•ã‚ŒãŸè¨˜äº‹ã‚’å–å¾— webhookã®ãƒ‡ãƒ¼ã‚¿ãŒå¤§äº‹
export async function getUpdatedFiles(payload: Webhook) {
  const BASE_URL = 'https://api.github.com/repos/wimpykid719/qiita-content/commits/'
  const latestCommitsha: string = payload.head_commit.id
  
  const updatedFileContents: Commits | undefined = await fetch(BASE_URL + latestCommitsha, {
    headers: {"Authorization": `token ${process.env.GITHUB_TOKEN}`}
  })
  .then(res => {
    if (res.ok) {
      return res.json();
    }
    return
  })
  .catch(err => {
    console.log(err);
  });
  const files = await Promise.all(updatedFileContents.files.map( async(updatedFile) => {
    // statusãŒå‰Šé™¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç„¡è¦–ã™ã‚‹ã€‚
    if(updatedFile.status === 'removed') {
      console.log('removedã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãªã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼¾ã„ãŸ')
      return
    }
    // statusãŒremovedä»¥å¤–ã§ã‚‚ã€æ‹¡å¼µå­ãŒmdãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ã®å ´åˆã¯å–å¾—ã—ãªã„
    if (!/[\s\S]*?\.md/.test(updatedFile.filename)) {
      return
    }
    const fileJson: Content | undefined = await fetch(updatedFile.contents_url, {
      headers: {"Authorization": `token ${process.env.GITHUB_TOKEN}`}
    })
    .then(res => {
      if (res.ok) {
        return res.json();
      }
      return
    })
    .catch(err => {
      console.log(err);
    });

    console.log(`fileJsonã®ä¸­èº«ï¼š${fileJson.name}`)
    
    const buffer = Buffer.from(fileJson.content, 'base64');
    const markdownContents = buffer.toString("utf-8");
    const matterResult = matter(markdownContents)
    if (!matterResult.data.published) {
      return
    }
    return {
      id: fileJson.name.replace(/\.md$/, ''),
      ...(matterResult.data as { title: string; emoji: string; type: string; topics: string[]; published: boolean; date: string; qiitaId: string; }),
      content: matterResult.content,
      path: fileJson.path,
      sha: fileJson.sha,
      markdownContents: markdownContents,
    }
  }))
  return files
}
```

webhookã‹ã‚‰å–å¾—ã—ãŸæœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆshaã‚’ä½¿ã†äº‹ã§ã€æœ€æ–°ã§ã‚³ãƒŸãƒƒãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—ã™ã‚‹äº‹ãŒã§ãã‚‹ã€‚ãã“ã«ã‚ã‚‹ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ãŒ `status` ã«ã‚ã‚Šå‰Šé™¤ã€ä¿®æ­£ã€æ–°è¦è¿½åŠ ãªã®ã‹ã‚ã‹ã‚‹ã€‚

`contents_url` ã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹äº‹ãŒã§ãã‚‹ã€‚

`filename` ã¯å¯¾è±¡ã¨ãªã£ã¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã€ã“ã‚Œã‚‰ãŒ `files` ã« `[object, object...]` ã®ã‚ˆã†ãªæ„Ÿã˜ã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚

`res.ok` ã§åˆ¤å®šã—ã¦ã„ã‚‹ã®ã¯ fetchãŒ404ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ãªã„ãŸã‚responseãŒæˆåŠŸã—ãŸéš›ã« `true` ã‚’è¿”ã™ `.ok` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚ `.status` ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦åˆ¤å®šã™ã‚‹äº‹ã‚‚å‡ºæ¥ã‚‹ã€‚

`contents_url` ã«fetchã‚’æŠ•ã’ã‚‹ã¨è¿”ã£ã¦æ¥ãŸJsonã«base64ã§ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’å–ã‚Šæ‰±ãˆã‚‹ã‚ˆã†ã«æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã€‚ãã—ã¦ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã«å«ã¾ã‚Œã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç­‰ã¨æ•´å½¢ã—ã¦Jsonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦è¿”ã™ã€‚

## makeQiitaArticle()

ã“ã‚Œã¯qiita APIã§æŠ•ç¨¿ã™ã‚‹éš›ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦è¿”ã™ã€‚

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ä½œæˆã—ãŸã€‚

[Qiita API v2 documentation - Qiita:Developer](https://qiita.com/api/v2/docs#post-apiv2items)

```tsx
//2 æŠ•ç¨¿ãƒ»æ›´æ–°ã•ã‚ŒãŸè¨˜äº‹ã‚’qiitaã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã™ã‚‹ã€‚
export function makeQiitaArticle(file: QiitaRepository) {
  const tags = file.topics.map((topic: string) => {
    return {'name': topic}
  })
  const article = {
    'body': file.content,
    'private': false,
    'tags': tags,
    'title': file.title,
    'tweet': true
  }
  return article
}
```

## postQiita()

å…ˆã»ã©ä½œæˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’fetchã§é€ã‚‹ã€‚

2å›ç›®ã®webhookã«ã‚ˆã‚‹å‡¦ç†ã®å ´åˆã€ã“ã“ã§å‡¦ç†ã‚’æ­¢ã‚ã‚‹ã€‚

```tsx
//3 qiitaã«æŠ•ç¨¿ã™ã‚‹ã€‚
export async function postQiita(qiitaArticle: QiitaArticle, idArticle: string) {
  const url = idArticle ? 
    'https://qiita.com/api/v2/items' + '/' +idArticle :
    'https://qiita.com/api/v2/items';
  console.log(`urlã®ç¢ºèªï¼š${url}`)

  const patchPostOk = await ( async(url, qiitaArticle, idArticle) => {
    // idãŒã‚ã‚‹ã‚„ã¤ã¯ã™ã§ã«æŠ•ç¨¿ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ãªã®ã§ã€è¨˜äº‹ã®æ›´æ–°ã‹ãã‚Œã¨ã‚‚2å›ç›®ã®ãƒ•ãƒƒã‚¯ã‹åˆ¤å®šã™ã‚‹ã€‚
    if(idArticle) {
      // è¨˜äº‹ãŒå­˜åœ¨ã™ã‚‹ã®ã‹å–å¾—ã™ã‚‹ã€‚è¨˜äº‹ãŒã‚ã‚‹ãªã‚‰JsonãŒè¿”ã‚‹ã€‚
      const qiitaArticleGetRes: QiitaArticleGetRes | undefined = await fetch(url, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${process.env.QIITA_TOKEN}`,
        },
        method: 'GET',
      })
      .then(res => {
        if (res.ok) {
          return res.json();
        } else {
          return
        }
      })
      .catch(err => {
        console.log(err);
      })
      // ã‚‚ã—ãªã‘ã‚Œã°idã¯ã‚ã‚‹ãŒè¨˜äº‹ã¯ãªã„ã“ã¨ã«ãªã‚‹ã€‚ã¤ã¾ã‚ŠidãŒé–“é•ã£ã¦ã„ã‚‹ã€‚
      if (!qiitaArticleGetRes) {
        return false
      }
      // idãŒã‚ã‚Šã€ã‚¢ãƒƒãƒ—äºˆå®šã®è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã¨å…ƒã€…ã®è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ãŒé•ã†ã€‚ã“ã‚Œã¯æ›´æ–°ã«ãªã‚‹ã€‚
      if(!(qiitaArticle.title === qiitaArticleGetRes.title)) {
        console.log('ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°')
        return true
      }
      // idãŒã‚ã‚Šã€ã‚¢ãƒƒãƒ—äºˆå®šã®è¨˜äº‹ã‚¿ã‚°ã¨å…ƒã€…ã®è¨˜äº‹ã‚¿ã‚°ãŒé•ã†ã€‚ã“ã‚Œã¯æ›´æ–°ã«ãªã‚‹ã€‚
      const flags2 = qiitaArticle.tags.map((tag) => {
        const flags = qiitaArticleGetRes.tags.map((resTag)=> {
          if(tag.name.toLowerCase() === resTag.name.toLowerCase()) {
            return false
          } else {
            return true
          }
        })
        return flags.every(v => v)
      })
      const flag = flags2.some(v => v)
      if(flag) {
        console.log('ã‚¿ã‚°æ›´æ–°')
        return true
      }
      // idãŒã‚ã‚Šã€ã‚¢ãƒƒãƒ—äºˆå®šã®è¨˜äº‹ã¨å…ƒã€…ã®è¨˜äº‹ãŒé•ã†ã€‚ã“ã‚Œã¯æ›´æ–°ã«ãªã‚‹ã€‚
      if(!(qiitaArticle.body === qiitaArticleGetRes.body)) {
        console.log('è¨˜äº‹æ›´æ–°')
        return true
      }
      // idãŒã‚ã£ã¦å¤‰æ›´ãŒç¢ºèªã•ã‚Œãªã„å ´åˆã¯2å›ç›®ã®webhookã«ã‚ˆã‚‹ã‚‚ã®ã ã‹ã‚‰å‡¦ç†ã‚’æ­¢ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
      return false
    }
    // idãŒãªã„ã‚„ã¤ã¯æ–°è¦æŠ•ç¨¿ã™ã‚‹ã€‚
    console.log('è¨˜äº‹æŠ•ç¨¿')
    return true
  })(url, qiitaArticle, idArticle)
  
  console.log(`æŠ•ç¨¿ã§ãã‚‹ã‹ç¢ºèªï¼š${patchPostOk}`)
  if (!patchPostOk) {
    return false
  }
  const method = idArticle ? 'PATCH': 'POST';
  console.log((`methodã®ç¢ºèªï¼š${method}`))
  console.log(`è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼š${qiitaArticle.title}`)

  
  const jsonQiitaArticle: string = JSON.stringify(qiitaArticle)
  const qiitaPostRes: QiitaPostRes | undefined = await fetch(url, {
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${process.env.QIITA_TOKEN}`,
    },
    method: method,
    body: jsonQiitaArticle,
  })
  .then(res => {
    if(res.ok) {
      return res.json();
    }
    return
  })
  .catch(err => {
    console.log(err);
  });
  return qiitaPostRes
}
```

`patchPostOk` ã«Pathãƒ»Postã‚’è¡Œã£ã¦ã‚‚è‰¯ã„å ´åˆã« `True` ã‚’è¿”ã—ã€2å›ç›®ã®webhookã®ãŸã‚å‡¦ç†ã‚’æ­¢ã‚ã‚‹å ´åˆã« `False` ãŒå…¥ã‚‹ã€‚

ãã‚Œã‚’èª¿ã¹ã‚‹æ–¹æ³•ã¨ã—ã¦qiitaIdã‚’ç”¨ã„ã¦è¡Œã†ã€‚

qiitaIdãŒãªã„ç‰©ã¯åˆã‚ã¦ã®æŠ•ç¨¿ã¨ãªã‚‹ãŸã‚æŠ•ç¨¿ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‚

qiitaIdãŒã‚ã‚‹ç‰©ã¯ã€è¨˜äº‹ã®æ›´æ–°ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã¾ãšã€ãã®qiitaIdã‚’æŒã¤è¨˜äº‹ã«qiita APIã‚’ä½¿ã£ã¦è¨˜äº‹æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãã—ã¦ãã‚Œã‚‰ã‚’æ¯”è¼ƒã—ã¦å·®ç•°ãŒã‚ã‚Œã°ã€è¨˜äº‹ã®æ›´æ–°ã ã¨åˆ¤æ–­ã™ã‚‹ã€‚å·®ç•°ãŒè¦‹ã‚‰ã‚Œãªã‘ã‚Œã°2å›ç›®ã®webhookã«ã‚ˆã‚‹å‡¦ç†ã¨åˆ¤æ–­ã—ä»¥é™ã«fetchã‚’æŠ•ã’ã‚‹å‡¦ç†ã‚’è¡Œã‚ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚

## writeQiitaId()

ã“ã“ã§ã¯æ–°è¦æŠ•ç¨¿æ™‚ã«å—ã‘å–ã£ãŸqiitaIdã‚’GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã«æ›¸ãè¾¼ã‚€ã€‚

æ›¸ãè¾¼ã¿ã¯æ–‡å­—åˆ—ã«ãªã£ã¦ã„ã‚‹ã®ã§æ­£è¦è¡¨ç¾ã§ç½®ãæ›ãˆãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’GitHub APIã§ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚ãã®éš›ã«æ›´æ–°ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€æ–°ã®shaãŒå¿…è¦ã¨ãªã‚‹ã€‚

```tsx
//4 githubã®ãƒªãƒã‚¸ãƒˆãƒªã«qiitaIdã‚’è¿½åŠ ã™ã‚‹ã€‚
export async function writeQiitaId(file: QiitaRepository, qiitaId: string) {
  console.log(`qiitaã‹ã‚‰ã®IDï¼š ${qiitaId}`)
  console.log(`fileã‹ã‚‰ã®IDï¼š ${file.qiitaId}`)
  const BASE_URL = 'https://api.github.com/repos/wimpykid719/qiita-content/contents/'
  const contentBeforeAddId = file.markdownContents
  // fileã®idã¯ç©ºã‹åŒã˜ã‚‚ã®ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€ä¸€è‡´ã—ãªã‘ã‚Œã°æ–°è¦æŠ•ç¨¿ã‚’æ„å‘³ã™ã‚‹ã€‚
  if(!(file.qiitaId === qiitaId)) {
    console.log(`shaï¼š${file.sha}`)
    //markdownã®æ–‡å­—åˆ—ã«æ­£è¦è¡¨ç¾ã§qiitaIdã‚’è¿½åŠ ã™ã‚‹ã€‚
    const contentAddId = contentBeforeAddId.replace(/(?<=---[\s\S]*?\nqiitaId:\s*').*?(?='[\s\S]*?---)/, `${qiitaId}`)
    const buffer = Buffer.from(contentAddId, 'utf-8');
    const content = buffer.toString("base64");

    const resRepo: PushRes | undefined = await fetch(BASE_URL + file.path, {
      headers: {
        'Accept': 'application/vnd.github.v3+json',
        'Authorization': `token ${process.env.GITHUB_TOKEN}`,
      },
      method: 'PUT',
      body: `{\
        "message":"write ${qiitaId}",\
        "content":"${content}",\
        "sha":"${file.sha}"\
      }`,
    })
    .then(res => {
      if (res.ok) {
        return res.json();
      }
      return
    })
    .catch(err => {
      console.log(err);
    });
    return resRepo
  }
  return 'stop to rewrite repository'
}
```

ä¸Šè¿°ã®ã‚³ãƒ¼ãƒ‰ã ã¨ã€è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€1ãƒ•ã‚¡ã‚¤ãƒ«1ã‚³ãƒŸãƒƒãƒˆè¦‹ãŸã„ãªæ„Ÿã˜ã«ãªã‚‹ã®ã§å¤‰æ›´ã‚’ã¾ã¨ã‚ã¦ã‚³ãƒŸãƒƒãƒˆã™ã‚‹äº‹ãŒã§ããªã„ã€‚ãã‚Œã‚’è¡Œã†ã«ã¯Git Date APIã‚’ç”¨ã„ã¦Blodã€Treeã®gitã®æ ¹æœ¬çš„ãªä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šå°‘ã€…é›£è§£ã ã£ãŸãŸã‚ã€æ¬¡å›Gitã®ä»•çµ„ã¿ã«é–¢ã™ã‚‹è¨˜äº‹ã‚’æ›¸ã„ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç°¡å˜ã«æ“ä½œå‡ºæ¥ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆã«æŒ‘æˆ¦ã—ã‚ˆã†ã¨æ€ã†ã€‚

## GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹Qiitaè¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ–ãƒ­ã‚°ã«è¿½åŠ ã™ã‚‹ã€‚

ä»Šåº¦ã¯ãƒ–ãƒ­ã‚°ã«QiitaæŠ•ç¨¿ã—ã¦ã„ã‚‹è¨˜äº‹ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ã‚’ `getPostsData()` é–¢æ•°ã«è¿½åŠ ã™ã‚‹ã€‚

å‰å›ã®Zennã®æŠ•ç¨¿è¨˜äº‹ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¨˜äº‹ã®å½¢å¼ã«ã™ã‚‹ã®ã¨åŒã˜äº‹ã‚’Qiitaãƒªãƒã‚¸ãƒˆãƒª ã«ã‚‚ã™ã‚‹ãã—ã¦æœ€å¾Œ2ã¤ã®é…åˆ—ã‚’åˆä½“ã—ã¦ä¸€ã¤ã®é…åˆ— `allDatas` ã«ã—ã¦è¿”ã™ã€‚

lib/posts.tsx

```tsx
export async function getPostsData() {
  const zennArticles: ArticleResponse[] = await fetchGithubRepo('https://api.github.com/repos/wimpykid719/zenn-content/contents/articles')

  const datas = await (async (zennArticles) => {
    if (zennArticles) {
      return await Promise.all(zennArticles.map( async (article: ArticleResponse) => {
        return fetchGithubMakeArticle('https://api.github.com/repos/wimpykid719/zenn-content/contents/articles/', article.name)
      }));
    }
  })(zennArticles);

  const qiitaArticles: ArticleResponse[] = await fetchGithubRepo('https://api.github.com/repos/wimpykid719/qiita-content/contents/articles')

  const datas2 = await (async (qiitaArticles) => {
    if (qiitaArticles) {
      return await Promise.all(qiitaArticles.map(async (article: ArticleResponse) => {
        return fetchGithubMakeArticle('https://api.github.com/repos/wimpykid719/qiita-content/contents/articles/', article.name)
      }));
    }
  })(qiitaArticles)

  const allDatas = datas.concat(datas2)

  const removeFalsyDatas = allDatas.filter(Boolean)
  return removeFalsyDatas;
}
```

ãã“ã§GitHubã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éƒ¨åˆ†ã¨mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›ã™ã‚‹éƒ¨åˆ†ã¯ã»ã¼åŒã˜å‡¦ç†ã«ãªã‚‹ã®ã§å…±é€šåŒ–ã™ã‚‹é–¢æ•°ã¨ã—ã¦utilityãƒ•ã‚©ãƒ«ãƒ€ã« `fetchGithubRepo()` ã¨ `fetchGithubMakeArticle()` ã«åˆ†ã‘ãŸã€‚

## fetchGithubRepo()

ä»Šã¾ã§fetchå‡¦ç†ãŒthenã¨awaitã‚’æ··åˆã—ã¦æ›¸ã„ã¦ã„ãŸã®ã§ã€ãã‚Œã‚’awaitã®ã¿ã«çµ±ä¸€ã—ãŸã“ã¡ã‚‰ã®æ–¹ãŒå¯èª­æ€§ãŒé«˜ãä¸»æµãªæ›¸ãæ–¹ã¨ãªã‚Šã¤ã¤ã‚ã‚‹ã®ã§ã€ä»–ã®é–¢æ•°ã«è¨˜è¿°ã•ã‚ŒãŸfetchå‡¦ç†ã‚‚ã“ã®ã‚ˆã†ã«æ›¸ãæ›ãˆãŸæ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚fetchã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã§ã¯ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’æ’å‡ºã—ãªã„ã®ã§ifæ–‡ã‚’ä½¿ã£ã¦æ’å‡ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

```tsx
export async function fetchGithubRepo(url: string) {
  try {
    const res = await fetch(url, {
      headers: {"Authorization": `token ${process.env.GITHUB_TOKEN}`}
    })
    if (!res.ok) {
      throw `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼š${res.status}`
    } else {
      return res.json()
    }
  } catch(err) {
    console.log(`repofetchãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ï¼š${err}`);
  }
}
```

## fetchGithubMakeArticle()

ã“ã‚Œã¯ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å€‹åˆ¥ã«mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãƒ–ãƒ­ã‚°ã«æŠ•ç¨¿å‡ºæ¥ã‚‹å½¢å¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œã‚‹ã€‚

qiitaIdã‚’æŒã¤å ´åˆã¯ `from: 'Qiita'` ã¨ã©ã“ã‹ã‚‰ã®è¨˜äº‹ãªã®ã‹åˆ†ã‹ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚Zennã‹ã‚‰ã®å ´åˆã¯ `from: 'Zenn'` ã¨ãªã‚‹ã€‚

![fromQiita](https://user-images.githubusercontent.com/23703281/122698265-ecc6d580-d281-11eb-84fa-696073a934b0.jpeg)


ã“ã®ã‚ˆã†ãªæ„Ÿã˜ã«å·¦ä¸‹éƒ¨ã§è¡¨ç¤ºã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã«ãªã£ã¦ã„ã‚‹ã€‚

```tsx
export async function fetchGithubMakeArticle(url: string, fileName: string) {
  try {
    const res = await fetch(url + fileName, {
      headers: {"Authorization": `token ${process.env.GITHUB_TOKEN}`}
    })
    if (!res.ok) {
      throw `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼š${res.status}`
    } else {
      const data = await res.json()
      const buffer = Buffer.from(data.content, 'base64');
      const fileContents = buffer.toString("utf-8");
      const matterResult = matter(fileContents)
      if (!matterResult.data.published) {
        return
      }
      if (matterResult.data.qiitaId) {
        return {
          id: fileName.replace(/\.md$/, ''),
          ...(matterResult.data as { title: string; emoji: string; type: string; topics: string[]; published: boolean; date: string; }),
          content: matterResult.content,
          from : 'Qiita'
        }
      }
      return {
        id: fileName.replace(/\.md$/, ''),
        ...(matterResult.data as { title: string; emoji: string; type: string; topics: string[]; published: boolean; date: string; }),
        content: matterResult.content,
        from: 'Zenn'
      }
    }
  } catch(err) {
    console.log(`contentfetchãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ï¼š${err}`);
  }
  
}
```

## æœ€å¾Œã«

ãªã‚“ã¨ã‹ãƒ–ãƒ­ã‚°ã«æ©Ÿèƒ½ã‚’ç„¡äº‹ã«è¿½åŠ ã™ã‚‹äº‹ãŒã§ããŸã€‚å‰å›ã®è¨˜äº‹ã§æ²ã’ãŸã‚„ã‚‹äº‹ãƒªã‚¹ãƒˆã«ã¯å…¨ãè¼‰ã£ã¦ãªã‹ã£ãŸãŒã€Vercelã®ã‚µãƒ¼ãƒãƒ¬ã‚¹ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†äº‹ãŒå‡ºæ¥ã¦ã‚ˆã‹ã£ãŸã€‚ã“ã‚ŒãŒç„¡æ–™ã§å‡ºæ¥ã‚‹ã®ã¯æœ¬å½“ã«ã‚ã‚ŠãŒãŸã„ã€‚

ä½œã‚Šå§‹ã‚ãŸæ™‚ã¯å°ã•ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’çµ„ã‚“ã§å„æ©Ÿèƒ½ã«å¿…è¦ãªå‹•ä½œãŒå‡ºæ¥ã‚‹ã‹ä¸€å€‹ãšã¤ç¢ºèªã—ã¦å‡ºæ¥ã‚‹ãªã¨æ€ã£ãŸã‚‰é–¢æ•°ã‚’æ›¸ãå§‹ã‚ã¦ã€ãã‚Œã‚’çµ„ã¿åˆã‚ã›ã¦ç›®çš„ã®æ©Ÿèƒ½ã«ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒé€£ç™ºã—ã¦ã€ãã“ã§ã¨ã¦ã‚‚æ™‚é–“ã‚’æµªè²»ã—ãŸã€‚

### åçœ

ãƒ†ã‚¹ãƒˆã‚’æ‰‹å‹•ã§è¡Œã£ã¦ã„ãŸãŒã€ã¨ã¦ã‚‚æ™‚é–“ã‚’é£Ÿã£ãŸã€‚Vercelã¯ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã£ã¦pushã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã¿ã«å¤‰æ›´ã‚’åŠ ãˆã¦ã‚’ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯å¤‰æ›´ã‚’åŠ ãˆã¦ãªã„çŠ¶æ…‹ã«ã—ã¦ãã‚Œã‚‹ï¼ˆã“ã‚Œã¯ã¨ã¦ã‚‚ã‚ã‚ŠãŒãŸã„ï¼‰ã€‚ãŸã æ¯å›ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã«1åˆ†ãã‚‰ã„ã‹ã‹ã‚‹ãŸã‚æ™‚é–“ãŒå–ã‚‰ã‚ŒãŸã€‚ã‚³ãƒ¼ãƒ‰ã‚’å°‘ã—ç›´ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’100å›ãã‚‰ã„ã¯ç¹°ã‚Šè¿”ã—ãŸã¨æ€ã†ã€‚ãŠã‹ã’ã§ã‚³ãƒŸãƒƒãƒˆæ•°ã ã‘ã¯ã¨ã¦ã‚‚ç¨¼ã’ã¦ã€ã™ã”ã„é–‹ç™ºã—ã¦ã‚‹ã‚„ã¤é¢¨ã®è‰ã‚’ç”Ÿã‚„ã›ãŸã€‚ãã“ã‹ã‚‰GitHubã«å®Ÿéš›ã«è¨˜äº‹ã‚’è¿½åŠ ã—ã¦webhookã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã—ã¦ã‚‚ã‚‰ã£ãŸã‚Šã€è¨˜äº‹ã‚’æ¶ˆã—ãŸã‚Šå®Ÿéš›ã®æ“ä½œã‚’ã¨ã«ã‹ãç¹°ã‚Šè¿”ã—ã¦æ™‚é–“ãŒã‹ã‹ã£ãŸã€‚ã‚ã¨Vercelã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã¯å¤‰æ•°ã®ä¸­èº«ãŒé•·ã„ã¨è¡¨ç¤ºå‡ºæ¥ãªã„ã¿ãŸã„ã§å‹•ä½œæ™‚ç‚¹ã§ã®å€¤ã‚’å…¨ã¦è¦‹ã‚‹äº‹ãŒå‡ºæ¥ãªã‹ã£ãŸã€‚ãã®ãŸã‚å¼•æ•°ã‚’é–“é•ãˆãŸã‚Šã—ã¦ã¨ã¦ã‚‚æ™‚é–“ã¨ç²¾ç¥ã‚’æŒã£ã¦ã‹ã‚ŒãŸã€‚webhookã‚’ç”¨ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºå‡ºæ¥ã‚‹ç’°å¢ƒã‚’ä½œã‚‹ã¹ãã ã£ãŸã€‚ä»Šæ€ã„ã¤ãã®ã¯webhookã§è²°ã†Jsonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠããã‚Œã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ä½¿ã†äº‹ãã‚‰ã„ã€‚

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸæ–¹ãŒè‰¯ã‹ã£ãŸã®ã§ã¯ã¨æ€ã†ã€‚HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ–¹ã¨ã‹ã‚¤ãƒ¡ãƒ¼ã‚¸å‡ºæ¥ãªã‹ã£ãŸã®ã§ã€æ‰‹ã‚’å‡ºã™äº‹ãŒå‡ºæ¥ãªã‹ã£ãŸã€‚ãã‚Œã‚‚webhookã§è²°ã†å€¤ã ã‘ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ãˆã°ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ãã†ãªæ°—ã¯ã™ã‚‹ã€‚

æ¥­å‹™ã§ä½œæ¥­ã—ã¦ã„ã‚‹æ–¹ã€…ã¯ã©ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã‚‹ã€‚ã‚‚ã—è‡ªåˆ†ã ã£ãŸã‚‰ã“ã‚“ãªæ„Ÿã˜ã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰æ›¸ãã‚ˆç­‰ã‚ã£ãŸã‚‰æ•™ãˆã¦é ‚ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

æœ€å¾Œã¾ã§è¨˜äº‹ã‚’èª­ã‚“ã§é ‚ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

### å‚ç…§

[Qiita API v2ã‚’åˆ©ç”¨ã—ã¦curlã§æŠ•ç¨¿ã—ã¦ã¿ãŸ - Qiita](https://qiita.com/kai_kou/items/663d3f7bbc4da4ccf62d)

[Qiita API ã§æŠ•ç¨¿ã‚’è‡ªå‹•åŒ–ã™ã‚‹ - Qiita](https://qiita.com/tomowarkar/items/11488231c6d22d960323)

[Qiita ã«æŠ•ç¨¿ã™ã‚‹æŠ€è¡“è¨˜äº‹ã‚’ GitHub ã§ç®¡ç†ã™ã‚‹æ–¹æ³• - Qiita](https://qiita.com/noraworld/items/79100783ba95d8c48924#github-webhook-%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B)

[webhook ã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰](https://docs.github.com/ja/developers/webhooks-and-events/webhooks/webhook-events-and-payloads)

[JSON.stringify() - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify)

[Fetch ã®ä½¿ç”¨ - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/Fetch_API/Using_Fetch)

[ãƒªãƒã‚¸ãƒˆãƒª](https://docs.github.com/ja/rest/reference/repos#get-repository-content)

[GitHubã®Git Data APIã§ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ - GeekFactory](https://int128.hatenablog.com/entry/2017/09/05/161641)

[Gitã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥å€¤ã¯ä½•ã‚’å…ƒã«ã©ã†ã‚„ã£ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ã‹](https://engineering.mercari.com/blog/entry/2016-02-08-173000/)

[js å½ã¨ã¿ãªã•ã‚Œã‚‹å€¤ã‚’é…åˆ—ã‹ã‚‰å–ã‚Šé™¤ã - Qiita](https://qiita.com/may88seiji/items/e89ecf9232dfbe79d84f)

Gitã®ä»•çµ„ã¿ã«é–¢ã—ã¦ã¯ã“ã®å‹•ç”»ãŒã¨ã¦ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã‹ã£ãŸã®ã§ã€æ¬¡å›ã‹ã‚‰ã“ã‚Œã‚’å…ƒã«Gitã®å‹‰å¼·ã‚’ã—ã‚ˆã†ã¨æ€ã†ã€‚

[Git Internals - Git Objects](https://www.youtube.com/watch?v=MyvyqdQ3OjI&list=LL&index=6)

è¨˜äº‹ã«é–¢ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆç­‰ã¯

ğŸ•Šï¼š[Twitter](https://twitter.com/Unemployed_jp)
ğŸ“ºï¼š[Youtube](https://www.youtube.com/channel/UCT3wLdiZS3Gos87f9fu4EOQ/featured?view_as=subscriber)
ğŸ“¸ï¼š[Instagram](https://www.instagram.com/unemployed_jp/)
ğŸ‘¨ğŸ»â€ğŸ’»ï¼š[Github](https://github.com/wimpykid719?tab=repositories)
ğŸ˜¥ï¼š[Stackoverflow](https://ja.stackoverflow.com/users/edit/22565)

ã§ã‚‚å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚ã©ã“ã‹ã«ã¯ã„ã¾ã™ã€‚